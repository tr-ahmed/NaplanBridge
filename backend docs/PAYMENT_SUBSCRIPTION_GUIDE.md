# ?? ???? ???? ????? ??????????? - NaplanBridge

## ?? ???? ????

???? ????? ?? NaplanBridge ???? ??? ?????? ?????? ????? ????? ???? ???????? ?????? ??????? ??????.

---

## ?? ????? ??? ????????

### 1. Single Term (??? Term ????)
**`PlanType.SingleTerm = 1`**

- **?????**: ?????? ?? ???? ????? ?? Term ???? ???
- **?????**: ~90 ??? (3 ????)
- **?? ?????**:
  - ?????? ????? ???? ?????? ?? Term ??????
  - ???? ??????? (PDFs, videos, etc.)
  - ?????????? ?????? ???? Term

**????**:
```json
{
  "name": "Algebra - Term 1",
  "planType": "SingleTerm",
  "price": 29.99,
  "subjectId": 1,
  "termId": 1,
  "durationInDays": 90
}
```

**Use Case**: ???? ???? ?????? ?? Algebra ?? Term 1 ???

---

### 2. Multi-Term (??? ??? Terms)
**`PlanType.MultiTerm = 2`**

- **?????**: ?????? ?? ???? ???? Terms (??? Term 1 & 2 ?? Term 3 & 4)
- **?????**: ~180 ??? (6 ????)
- **?? ?????**:
  - ?????? ????? ???? ?????? ?? Terms ???????
  - ??? ???? ?? ???????? ?? Term ????
- **??? ???**: `includedTermIds` (??? "1,2" ?? "3,4")

**????**:
```json
{
  "name": "Algebra - Term 1 & 2",
  "planType": "MultiTerm",
  "price": 49.99,
"subjectId": 1,
  "includedTermIds": "1,2",
  "durationInDays": 180
}
```

**Use Case**: ???? ???? ?????? ?? Algebra ?? Term 1 ? Term 2 ???? ???? ????

---

### 3. Subject Annual (??? ???? ?????)
**`PlanType.SubjectAnnual = 4`**

- **?????**: ?????? ?? ???? ????? ????? ??????? (???? Terms)
- **?????**: 365 ??? (??? ?????)
- **?? ?????**:
  - ?????? ????? ???? ?????? ?? ?? Terms
  - ???? ???? ????? ????? ?????? ???????

**????**:
```json
{
  "name": "Algebra - Full Year",
  "planType": "SubjectAnnual",
  "price": 89.99,
  "subjectId": 1,
  "durationInDays": 365
}
```

**Use Case**: ???? ???? ?????? ???? ?? Algebra

---

### 4. Full Year (??? ????? ???????)
**`PlanType.FullYear = 3`**

- **?????**: ?????? ?? **???? ??????** ?? ??? ?????? ?????
- **?????**: 365 ??? (??? ?????)
- **?? ?????**:
  - ?????? ????? ?????? ?? Year ??????
  - ???? Terms ??? ????
  - ???? ???? ?????

**????**:
```json
{
  "name": "Year 7 - All Subjects",
  "planType": "FullYear",
  "price": 299.99,
  "yearId": 1,
  "durationInDays": 365
}
```

**Use Case**: ???? ???? ?????? ????? ???? Year 7

---

## ?? ???? ????? ??????

### ??????? 1: ???? ????? ???????

```http
GET /api/subscriptionplans/student/{studentId}/available
Authorization: Bearer {token}
```

**Response**:
```json
[
  {
    "planId": 1,
    "name": "Algebra - Term 1",
    "description": "Access to Algebra for Term 1",
    "price": 29.99,
    "planType": "SingleTerm",
    "coverageDescription": "Algebra - Term 1"
  },
  {
  "planId": 2,
    "name": "Algebra - Term 1 & 2",
    "description": "Access to Algebra for Term 1 and 2",
    "price": 49.99,
    "planType": "MultiTerm",
    "coverageDescription": "Multiple Terms - 1,2"
  },
  {
    "planId": 3,
    "name": "Algebra - Full Year",
    "description": "Access to Algebra for the whole year",
    "price": 89.99,
    "planType": "SubjectAnnual",
    "coverageDescription": "Algebra - Full Year"
  },
  {
    "planId": 4,
    "name": "Year 7 - All Subjects",
    "description": "Access to all subjects in Year 7",
    "price": 299.99,
    "planType": "FullYear",
    "coverageDescription": "All Subjects - Grade 7"
  }
]
```

---

### ??????? 2: ????? ?????

```http
POST /api/cart/add
Authorization: Bearer {token}
Content-Type: application/json

{
  "subscriptionPlanId": 2,
  "studentId": 5,
  "quantity": 1
}
```

**Response**:
```json
{
  "message": "Item added to cart",
  "cartId": 1,
  "itemId": 1
}
```

---

### ??????? 3: ?????? ?????

```http
GET /api/cart
Authorization: Bearer {token}
```

**Response**:
```json
{
  "id": 1,
  "userId": 1,
  "items": [
    {
      "id": 1,
      "subscriptionPlanId": 2,
      "subscriptionPlanName": "Algebra - Term 1 & 2",
      "studentId": 5,
      "studentName": "Ali Ahmed",
      "quantity": 1,
      "unitPrice": 49.99,
      "totalPrice": 49.99,
"subjectName": "Algebra"
    }
  ],
  "totalAmount": 49.99,
  "itemCount": 1
}
```

---

### ??????? 4: ????? Order

```http
POST /api/order/create-from-cart
Authorization: Bearer {token}
```

**Response**:
```json
{
  "id": 1,
  "userId": 1,
"totalAmount": 49.99,
  "orderStatus": "Pending",
  "items": [
    {
"id": 1,
      "subscriptionPlanName": "Algebra - Term 1 & 2",
      "studentName": "Ali Ahmed",
  "quantity": 1,
"unitPrice": 49.99,
      "totalPrice": 49.99
    }
  ]
}
```

---

### ??????? 5: ????? ??? Stripe

```http
POST /api/payment/create-checkout-session
Authorization: Bearer {token}
Content-Type: application/json

{
  "orderId": 1,
  "successUrl": "https://yourapp.com/payment/success",
  "cancelUrl": "https://yourapp.com/payment/cancel"
}
```

**Response**:
```json
{
  "sessionId": "cs_test_a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6",
  "sessionUrl": "https://checkout.stripe.com/pay/cs_test_...",
  "orderId": 1
}
```

**?????? ???????**: ????? ???????? ?? `sessionUrl`

```typescript
window.location.href = response.sessionUrl;
```

---

### ??????? 6: Stripe Webhook (??????)

??? ???? ?????? Stripe ???? webhook ??? API:

```http
POST /api/stripewebhook
Stripe-Signature: {signature}
```

**?? ???? ???????**:
1. ?????? ?? ??? ??? webhook ?? Stripe
2. ????? Order status ? `Paid`
3. **????? Subscriptions ????????** ??? CartItem ?? Order
4. ????? ????? ?????? ???? ?????
5. ????? ?????? ??????? ?????

---

### ??????? 7: ?????? ?? ?????????? ??????

```http
GET /api/studentsubjects/student/{studentId}/subscriptions-summary
Authorization: Bearer {token}
```

**Response**:
```json
{
  "totalActiveSubscriptions": 1,
  "subscriptions": [
    {
      "id": 1,
      "planName": "Algebra - Term 1 & 2",
      "planType": "MultiTerm",
      "subjectName": "Algebra",
      "termName": null,
      "yearName": null,
    "startDate": "2025-01-24T00:00:00Z",
      "endDate": "2025-07-23T00:00:00Z",
      "daysRemaining": 180
    }
  ]
}
```

---

## ?? ?????? ??? ?????? ???????

### ??????: ??? ?????? ???? ???? ???? ???

```http
GET /api/studentsubjects/student/{studentId}/available-subjects
Authorization: Bearer {token}
```

**Response**: ????? ????? ?????? ???? ???? ?????? ??? ????

```json
[
  {
    "id": 1,
    "subjectName": "Algebra",
    "categoryName": "Mathematics",
    "price": 49.99,
    "posterUrl": "https://...",
    "termNumber": 4,
    "weekNumber": 12
  }
]
```

**???? ???????**:
- ??? ??? ???????? ?? **???? ?????** ? ????? ??? ??????
- ??? ??? ???????? ?? **Term ????** ? ????? ?????? ?????? ???? Term
- ??? ??? ???????? ?? **Multiple Terms** ? ????? ?????? ?????? ??? Terms ???????
- ??? ??? ???????? ?? **Year ????** ? ????? **???? ??????** ?? ??? ?????

---

## ?? ?????? ?? ??????

### 1. ?????? ?? ?????? ?????

```http
GET /api/studentsubjects/student/{studentId}/has-access/subject/{subjectId}
Authorization: Bearer {token}
```

**Response**: `true` ?? `false`

---

### 2. ?????? ?? ?????? ????

```http
GET /api/studentsubjects/student/{studentId}/has-access/lesson/{lessonId}
Authorization: Bearer {token}
```

**Response**: `true` ?? `false`

**???? ???????**:
- ?????? ?? ?????? ??????
- ?? ?????? ?? Term ???? ????? ?????
- ?? ?????? ?? Multiple Terms ???? ??? Term
- ?? ?????? ?? Year ???? ????? ??????

---

### 3. ?????? ?? ?????? ???????

```http
GET /api/studentsubjects/student/{studentId}/has-access/exam/{examId}
Authorization: Bearer {token}
```

**Response**: `true` ?? `false`

**???? ???????**: ??? ???? ?????

---

## ?? ???? ??????? ???????

### ????? ??????? ????????

#### 1. Text (???? ???)
**`QuestionType.Text = 1`**

- ?????? ???? ??????? ?? text field
- ????? ????? ???? ?? ??????

**????**:
```json
{
  "questionText": "???? ????? ????? ?????",
  "questionType": "Text",
  "marks": 10
}
```

---

#### 2. Multiple Choice (?????? ????)
**`QuestionType.MultipleChoice = 2`**

- ??? ??????? ????? ????? ????? ???
- ????? ??????

**????**:
```json
{
  "questionText": "?? ?? 2 + 2?",
  "questionType": "MultipleChoice",
  "marks": 5,
  "isMultipleSelect": false,
  "options": [
    { "optionText": "3", "isCorrect": false },
    { "optionText": "4", "isCorrect": true },
    { "optionText": "5", "isCorrect": false }
  ]
}
```

---

#### 3. Multiple Select (?????? ?????)
**`QuestionType.MultipleSelect = 3`**

- ??? ??????? ???? ?? ????? ?????
- ????? ?????? (??? ?????? ???? ???????? ???????)

**????**:
```json
{
  "questionText": "?? ?? ?????? ????? ??????",
  "questionType": "MultipleSelect",
  "marks": 5,
  "isMultipleSelect": true,
  "options": [
    { "optionText": "2", "isCorrect": true },
    { "optionText": "3", "isCorrect": true },
    { "optionText": "4", "isCorrect": false },
    { "optionText": "5", "isCorrect": true }
  ]
}
```

---

#### 4. True/False (?? ?? ???)
**`QuestionType.TrueFalse = 4`**

- ?????? ???: ?? ?? ???
- ????? ??????

**????**:
```json
{
  "questionText": "????? ?????",
  "questionType": "TrueFalse",
  "marks": 2,
  "options": [
    { "optionText": "??", "isCorrect": false },
    { "optionText": "???", "isCorrect": true }
  ]
}
```

---

## ?? ???? ?????????? ???????

### ????? ??????????

#### 1. Lesson Exam (?????? ???)
**`ExamType.Lesson = 1`**

- ?????? ??? ??? ???? ???
- ???? 5-10 ?????
- ???: 15-30 ?????

**Endpoint ???????**:
```http
POST /api/exam
{
  "title": "Lesson 1 Quiz",
  "examType": "Lesson",
  "subjectId": 1,
  "lessonId": 1,
  "durationInMinutes": 15,
  "questions": [...]
}
```

---

#### 2. Monthly Exam (?????? ????)
**`ExamType.Monthly = 2`**

- ?????? ??? ?????? ???? (????? ?? ??? ??????)
- ???? 15-20 ????
- ???: 45-60 ?????

**Endpoint ???????**:
```http
POST /api/exam
{
  "title": "Week 1-4 Monthly Test",
  "examType": "Monthly",
  "subjectId": 1,
  "weekId": 4,
  "durationInMinutes": 60,
  "questions": [...]
}
```

---

#### 3. Term Exam (?????? Term)
**`ExamType.Term = 3`**

- ?????? ??? Term ????
- ???? 30-50 ????
- ???: 90-120 ?????

**Endpoint ???????**:
```http
POST /api/exam
{
  "title": "Term 1 Final Exam",
  "examType": "Term",
  "subjectId": 1,
  "termId": 1,
  "durationInMinutes": 120,
  "questions": [...]
}
```

---

#### 4. Year Exam (?????? ?????)
**`ExamType.Year = 4`**

- ?????? ??? ????? ???????
- ???? 50-100 ????
- ???: 120-180 ?????

**Endpoint ???????**:
```http
POST /api/exam
{
  "title": "Year 7 Final Exam",
  "examType": "Year",
  "subjectId": 1,
  "durationInMinutes": 180,
  "questions": [...]
}
```

---

## ?? ???? ????????

### 1. ??? ????????

```http
POST /api/exam/{examId}/start
Authorization: Bearer {token}
```

**Response**:
```json
{
  "studentExamId": 1,
  "examId": 1,
  "title": "Term 1 Final Exam",
  "examType": "Term",
  "startedAt": "2025-01-24T10:00:00Z",
  "durationInMinutes": 120,
  "questions": [
    {
"id": 1,
      "questionText": "?? ?? 2 + 2?",
   "questionType": "MultipleChoice",
      "marks": 5,
      "isMultipleSelect": false,
   "order": 1,
    "options": [
        { "id": 1, "optionText": "3" },
     { "id": 2, "optionText": "4" },
        { "id": 3, "optionText": "5" }
      ]
    }
  ]
}
```

---

### 2. ????? ????????

```http
POST /api/exam/{examId}/submit
Authorization: Bearer {token}

{
  "studentExamId": 1,
  "answers": [
    {
      "questionId": 1,
      "selectedOptionId": 2
    },
    {
      "questionId": 2,
 "selectedOptionIds": [3, 5, 7]
    },
    {
      "questionId": 3,
    "textAnswer": "????? ????? ????? ??? ???..."
    }
  ]
}
```

**Response**:
```json
{
  "studentExamId": 1,
  "totalMarks": 100,
  "obtainedMarks": 85,
  "percentage": 85,
  "passed": true,
  "submittedAt": "2025-01-24T11:50:00Z",
  "questions": [
    {
      "questionId": 1,
      "questionText": "?? ?? 2 + 2?",
      "questionType": "MultipleChoice",
      "marks": 5,
      "obtainedMarks": 5,
    "isCorrect": true,
      "correctAnswer": "4",
      "studentAnswer": "4"
    }
  ]
}
```

---

## ?? Best Practices ??? Front-end

### 1. Cache ????? ???????
```typescript
// Cache for 1 hour
const availablePlans = await fetchWithCache(
  `/api/subscriptionplans/student/${studentId}/available`,
  { ttl: 3600 }
);
```

### 2. ?????? ?? ?????? ??? ??? ???????
```typescript
async function openLesson(studentId: number, lessonId: number) {
  const hasAccess = await checkAccess(
    `/api/studentsubjects/student/${studentId}/has-access/lesson/${lessonId}`
  );
  
  if (!hasAccess) {
showUpgradeModal();
    return;
  }
  
  // Open lesson
  navigateTo(`/lesson/${lessonId}`);
}
```

### 3. ??? ?????? ??????? ???
```typescript
// ?? ???? ??????
const availableSubjects = await fetch(
  `/api/studentsubjects/student/${studentId}/available-subjects`
);

// ??? ?????? ??? ???? ???? ???? ???
displaySubjects(availableSubjects);
```

---

## ?? ???? ??? Endpoints ???????

| Endpoint | Method | ????? |
|----------|--------|-------|
| `/api/studentsubjects/student/{id}/available-subjects` | GET | ?????? ??????? |
| `/api/studentsubjects/student/{id}/has-access/subject/{subjectId}` | GET | ?????? ?? ???? ???? |
| `/api/studentsubjects/student/{id}/has-access/lesson/{lessonId}` | GET | ?????? ?? ???? ??? |
| `/api/studentsubjects/student/{id}/has-access/exam/{examId}` | GET | ?????? ?? ???? ?????? |
| `/api/studentsubjects/student/{id}/subscriptions-summary` | GET | ???? ?????????? |

---

**??? ?????**: 2025-01-24  
**???????**: 2.0
