<!-- Page Header with Blue Background -->
<div class="page-header-wrapper">
  <div class="page-header-content">
    <div class="header-icon">
      <i class="fas fa-envelope-open-text"></i>
    </div>
    <div class="header-text">
      <h1>Notification Templates</h1>
      <p>Manage notification messages for all system events</p>
    </div>
  </div>
</div>

<div class="template-list-container">
  <!-- Header with Stats -->
  <div class="page-header">
    <div class="header-content">

      <!-- Stats Cards -->
      @if (counts()) {
        <div class="stats-cards">
          <div class="stat-card">
            <div class="stat-icon total">
              <i class="fas fa-layer-group"></i>
            </div>
            <div class="stat-info">
              <span class="stat-value">{{ counts()!.totalTemplates }}</span>
              <span class="stat-label">Total Templates</span>
            </div>
          </div>

          <div class="stat-card">
            <div class="stat-icon active">
              <i class="fas fa-check-circle"></i>
            </div>
            <div class="stat-info">
              <span class="stat-value">{{ counts()!.activeTemplates }}</span>
              <span class="stat-label">Active</span>
            </div>
          </div>

          <div class="stat-card">
            <div class="stat-icon inactive">
              <i class="fas fa-pause-circle"></i>
            </div>
            <div class="stat-info">
              <span class="stat-value">{{ counts()!.inactiveTemplates }}</span>
              <span class="stat-label">Inactive</span>
            </div>
          </div>
        </div>
      }
    </div>
  </div>

  <!-- Filters & Search -->
  <div class="filters-section">
    <div class="filters-row">
      <!-- Search -->
      <div class="search-box">
        <i class="fas fa-search"></i>
        <input
          type="text"
          placeholder="Search templates..."
          [(ngModel)]="searchQuery"
          (input)="onSearch()">
      </div>

      <!-- Category Filter -->
      <select
        class="filter-select"
        [(ngModel)]="selectedCategory"
        (change)="onFilterChange()">
        <option value="all">All Categories</option>
        <option *ngFor="let cat of categories" [value]="cat">{{ cat }}</option>
      </select>

      <!-- Channel Filter -->
      <select
        class="filter-select"
        [(ngModel)]="selectedChannel"
        (change)="onFilterChange()">
        <option value="all">All Channels</option>
        <option *ngFor="let ch of channels" [value]="ch">{{ ch }}</option>
      </select>

      <!-- Status Filter -->
      <select
        class="filter-select"
        [(ngModel)]="selectedStatus"
        (change)="onFilterChange()">
        <option value="all">All Status</option>
        <option value="active">Active Only</option>
        <option value="inactive">Inactive Only</option>
      </select>

      <!-- View Mode Toggle -->
      <div class="view-toggle">
        <button
          [class.active]="viewMode() === 'grid'"
          (click)="setViewMode('grid')"
          title="Grid View">
          <i class="fas fa-th"></i>
        </button>
        <button
          [class.active]="viewMode() === 'list'"
          (click)="setViewMode('list')"
          title="List View">
          <i class="fas fa-list"></i>
        </button>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  @if (loading()) {
    <div class="loading-state">
      <i class="fas fa-spinner fa-spin fa-3x"></i>
      <p>Loading templates...</p>
    </div>
  }

  <!-- Error State -->
  @if (error()) {
    <div class="error-state">
      <i class="fas fa-exclamation-circle fa-3x"></i>
      <p>{{ error() }}</p>
      <button class="retry-btn" (click)="loadTemplates()">
        <i class="fas fa-redo"></i> Retry
      </button>
    </div>
  }

  <!-- Templates Grid/List -->
  @if (!loading() && !error()) {
    <div [class]="'templates-' + viewMode()">
      @for (template of filteredTemplates; track template.id) {
        <div class="template-card" (click)="editTemplate(template)">
          <!-- Card Header -->
          <div class="card-header">
            <div class="event-info">
              <div
                class="category-icon"
                [style.background-color]="getCategoryColor(template.eventCategory)">
                <i class="fas" [ngClass]="getCategoryIcon(template.eventCategory)"></i>
              </div>
              <div class="event-details">
                <h3>{{ translateText(template.eventName) }}</h3>
                <span class="event-key">{{ template.eventKey }}</span>
              </div>
            </div>

            <!-- Status Badge -->
            <div class="status-section">
              <span
                class="status-badge"
                [class.active]="template.isActive"
                [class.inactive]="!template.isActive">
                {{ template.isActive ? 'Active' : 'Inactive' }}
              </span>
            </div>
          </div>

          <!-- Card Body -->
          <div class="card-body">
            <!-- Category Badge -->
            @if (template.eventCategory) {
              <span class="category-badge">
                <i class="fas" [ngClass]="getCategoryIcon(template.eventCategory)"></i>
                {{ translateText(template.eventCategory) }}
              </span>
            }

            <!-- Description Preview -->
            @if (template.eventDescription) {
              <p class="description">{{ translateText(template.eventDescription) }}</p>
            }

            <!-- Channels -->
            <div class="channels">
              <span class="channels-label">Channels:</span>
              <div class="channel-badges">
                @for (channel of getEnabledChannels(template); track channel) {
                  <span
                    class="channel-badge"
                    [style.color]="getChannelColor(channel)">
                    <i class="fas" [ngClass]="getChannelIcon(channel)"></i>
                    {{ channel }}
                  </span>
                }
                @if (getEnabledChannels(template).length === 0) {
                  <span class="no-channels">No channels enabled</span>
                }
              </div>
            </div>

            <!-- Variables Info -->
            @if (template.availableVariables && template.availableVariables.length > 0) {
              <div class="variables-info">
                <i class="fas fa-code"></i>
                {{ template.availableVariables.length }} variables available
              </div>
            }
          </div>

          <!-- Card Actions -->
          <div class="card-actions">
            <button
              class="action-btn"
              (click)="editTemplate(template)"
              title="Edit Template">
              <i class="fas fa-edit"></i>
              Edit
            </button>

            <button
              class="action-btn"
              (click)="toggleStatus(template, $event)"
              [title]="template.isActive ? 'Deactivate' : 'Activate'">
              <i class="fas" [ngClass]="template.isActive ? 'fa-pause' : 'fa-play'"></i>
              {{ template.isActive ? 'Deactivate' : 'Activate' }}
            </button>

            <button
              class="action-btn reset"
              (click)="resetTemplate(template, $event)"
              title="Reset to Default">
              <i class="fas fa-undo"></i>
              Reset
            </button>
          </div>
        </div>
      } @empty {
        <div class="empty-state">
          <i class="fas fa-inbox fa-3x"></i>
          <h3>No templates found</h3>
          <p>Try adjusting your filters</p>
        </div>
      }
    </div>
  }
</div>
