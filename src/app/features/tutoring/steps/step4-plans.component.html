<div class="step-container">
      <div class="header">
        <h2 class="step-title">Step 5: Select Hours for Each Subject</h2>
        <p class="step-subtitle">Choose 10, 20, or 30 hours (get additional discounts)</p>
      </div>

      <div *ngFor="let student of students" class="student-section">
        <div class="student-header">
          <span class="student-icon">ğŸ“</span>
          <h3 class="student-name">{{ student.name }}'s Hours</h3>
        </div>

        <!-- Discount Cap Info Banner -->
        <div *ngIf="getMultiSubjectDiscount(student.id) >= 20" class="discount-cap-banner maxed">
          <span class="banner-icon">âš ï¸</span>
          <span class="banner-text">Maximum 20% discount already applied from subjects. No additional hours discount available.</span>
        </div>
        <div *ngIf="getMultiSubjectDiscount(student.id) > 0 && getMultiSubjectDiscount(student.id) < 20" class="discount-cap-banner info">
          <span class="banner-icon">ğŸ’¡</span>
          <span class="banner-text">{{ getMultiSubjectDiscount(student.id) }}% discount from subjects. Hours discount limited to {{ 20 - getMultiSubjectDiscount(student.id) }}% max (20% total cap).</span>
        </div>

        <div *ngFor="let subject of getStudentSubjects(student.id)" class="subject-row">
          <div class="subject-info">
            <h4 class="subject-title">{{ getSubjectName(subject) }}</h4>
          </div>

          <div class="hours-options">
            <!-- 10 Hours -->
            <div
              (click)="selectHours(student.id, subject, 10)"
              [class.selected]="getSelectedHours(student.id, subject) === 10"
              class="hours-option">
              <div class="option-header">
                <h5>10 Hours</h5>
                <div *ngIf="getSelectedHours(student.id, subject) === 10" class="check">âœ“</div>
              </div>
              <p class="duration">12 weeks</p>
              <div class="price">\${{ getSubjectPrice(subject) * 10 }}</div>
            </div>

            <!-- 20 Hours -->
            <div
              (click)="selectHours(student.id, subject, 20)"
              [class.selected]="getSelectedHours(student.id, subject) === 20"
              class="hours-option featured">
              <span class="badge">Popular</span>
              <div class="option-header">
                <h5>20 Hours</h5>
                <div *ngIf="getSelectedHours(student.id, subject) === 20" class="check">âœ“</div>
              </div>
              <p class="duration">12 weeks Â· Unlocks {{ hoursDiscountTiers.hours20 }}% OFF</p>
              <div class="price">\${{ getSubjectPrice(subject) * 20 }}</div>
            </div>

            <!-- 30 Hours -->
            <div
              (click)="selectHours(student.id, subject, 30)"
              [class.selected]="getSelectedHours(student.id, subject) === 30"
              class="hours-option premium">
              <span class="badge best">Best Value</span>
              <div class="option-header">
                <h5>30 Hours</h5>
                <div *ngIf="getSelectedHours(student.id, subject) === 30" class="check">âœ“</div>
              </div>
              <p class="duration">12 weeks Â· Unlocks {{ hoursDiscountTiers.hours30 }}% OFF</p>
              <div class="price">\${{ getSubjectPrice(subject) * 30 }}</div>
            </div>
          </div>
        </div>

        <!-- Student Total Discount Summary (Compact) -->
        <div *ngIf="getTotalStudentDiscount(student.id) > 0" class="discount-summary-compact">
          <div class="discount-pills">
            <span *ngIf="getMultiSubjectDiscount(student.id) > 0" class="discount-pill subjects">
              ğŸ“š {{ getMultiSubjectDiscount(student.id) }}%
            </span>
            <span *ngIf="getEffectiveHoursDiscount(student.id) > 0" class="discount-pill hours">
              â±ï¸ {{ getEffectiveHoursDiscount(student.id) }}%
            </span>
            <span class="discount-pill total" [class.maxed]="getTotalStudentDiscount(student.id) >= 20">
              ğŸ‰ Total: {{ getTotalStudentDiscount(student.id) }}% OFF
            </span>
          </div>
        </div>
      </div>

      <!-- Navigation -->
      <div class="nav-buttons">
        <button
          type="button"
          (click)="previousStep()"
          class="btn btn-secondary">
          â† Back
        </button>
        <button
          type="button"
          (click)="nextStep()"
          [disabled]="!canProceed()"
          class="btn btn-primary">
          Next: Schedule Sessions â†’
        </button>
      </div>
    </div>
