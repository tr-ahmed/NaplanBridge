<!-- Lesson Detail Page -->
<div class="min-h-screen bg-gray-50 pt-24 pb-8">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">

    <!-- Header Section -->
    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6 mb-8">
      <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
        <div class="flex-1">
          <button
            (click)="goBack()"
            class="flex items-center text-blue-600 hover:text-blue-800 mb-4 transition-colors duration-200">
            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
            </svg>
            Back to Lessons
          </button>

          @if (lesson()) {
            <h1 class="text-3xl font-bold text-gray-900 mb-2">{{ lesson()!.title }}</h1>
            <p class="text-gray-600 mb-4">{{ lesson()!.description }}</p>

            <div class="flex flex-wrap gap-4 text-sm text-gray-500">
              <span class="flex items-center">
                <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                {{ lesson()!.duration }} minutes
              </span>
              <span class="flex items-center">
                <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l6-6v13l6-6v13l-6-6v6l-6 6z"></path>
                </svg>
                {{ lesson()!.difficulty }}
              </span>
              <span class="flex items-center">
                <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 4V2a1 1 0 011-1h4a1 1 0 011 1v2h4a1 1 0 110 2H6a1 1 0 110-2h1z"></path>
                </svg>
                Term {{ lesson()!.term }} - Week {{ lesson()!.week }}
              </span>
            </div>
          }
        </div>

        <!-- Progress Info -->
        @if (studentLesson()) {
          <div class="bg-blue-50 rounded-lg p-4 min-w-[200px]">
            <div class="text-sm text-blue-800 font-medium mb-2">Your Progress</div>
            <div class="flex items-center gap-3">
              <div class="flex-1 bg-blue-200 rounded-full h-2">
                <div
                  class="bg-blue-600 h-2 rounded-full transition-all duration-300"
                  [style.width.%]="studentLesson()!.progress.progress">
                </div>
              </div>
              <span class="text-sm text-blue-800 font-medium">{{ studentLesson()!.progress.progress }}%</span>
            </div>
          </div>
        }
      </div>
    </div>

    <!-- Loading State -->
    @if (loading()) {
      <div class="flex justify-center items-center py-12">
        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"></div>
        <span class="ml-3 text-gray-600">Loading lesson...</span>
      </div>
    }

    <!-- Error State -->
    @if (error()) {
      <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg mb-6">
        <div class="flex items-center">
          <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
          </svg>
          {{ error() }}
        </div>
      </div>
    }

    <!-- Lesson Navigation -->
    @if (!loading() && lesson()) {
      <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-3 md:p-4 mb-8">
        <div class="flex items-center justify-between gap-2">
          <!-- Previous Lesson -->
          <div class="flex-1 min-w-0">
            @if (hasPreviousLesson()) {
              <button
                (click)="goToPreviousLesson()"
                class="flex items-center text-blue-600 hover:text-blue-800 hover:bg-blue-50 px-2 md:px-4 py-2 rounded-lg transition-all duration-200 w-full md:w-auto">
                <svg class="w-4 md:w-5 h-4 md:h-5 mr-1 md:mr-2 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                </svg>
                <div class="text-left min-w-0">
                  <div class="text-xs text-gray-500 hidden sm:block">Previous</div>
                  <div class="font-medium text-sm md:text-base truncate">{{ previousLesson()?.title }}</div>
                </div>
              </button>
            }
          </div>

          <!-- Current Lesson Info -->
          <div class="flex-1 text-center px-2">
            <div class="text-xs md:text-sm text-gray-500">Lesson {{ lesson()!.order }}</div>
            <div class="font-semibold text-sm md:text-base text-gray-900 truncate">{{ lesson()!.title }}</div>
          </div>

          <!-- Next Lesson -->
          <div class="flex-1 flex justify-end min-w-0">
            @if (hasNextLesson()) {
              <button
                (click)="goToNextLesson()"
                class="flex items-center text-blue-600 hover:text-blue-800 hover:bg-blue-50 px-2 md:px-4 py-2 rounded-lg transition-all duration-200 w-full md:w-auto">
                <div class="text-right min-w-0">
                  <div class="text-xs text-gray-500 hidden sm:block">Next</div>
                  <div class="font-medium text-sm md:text-base truncate">{{ nextLesson()?.title }}</div>
                </div>
                <svg class="w-4 md:w-5 h-4 md:h-5 ml-1 md:ml-2 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                </svg>
              </button>
            }
          </div>
        </div>
      </div>
    }

    <!-- Main Content -->
    @if (!loading() && lesson()) {
      <!-- Tab Navigation -->
      <div class="bg-white rounded-2xl shadow-sm border border-gray-100 mb-8">
        <div class="border-b border-gray-200">
          <!-- Mobile Dropdown Navigation (for very small screens) -->
          <div class="block sm:hidden px-4 py-3">
            <select
              [value]="activeTab()"
              (change)="setActiveTab($any($event.target).value)"
              class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm">
              <option value="video">üìπ Video</option>
              <option value="resources">üìé Resources ({{ lesson()?.resources?.length || 0 }})</option>
              @if (hasQuizzes()) {
                <option value="quiz">‚ùì Quiz ({{ quizzes().length }})</option>
              }
              <option value="notes">üìù Notes ({{ notes().length }})</option>
              <option value="teacher">üë®‚Äçüè´ Ask Teacher ({{ teacherQuestions().length }})</option>
              @if (hasChapters()) {
                <option value="chapters">üìã Chapters ({{ videoChapters().length }})</option>
              }
              @if (canEditContent()) {
                <option value="quiz-maker">üõ†Ô∏è Quiz Maker ({{ quizMakers().length }})</option>
              }
            </select>
          </div>

          <!-- Horizontal Scroll Navigation (for small screens and up) -->
          <nav class="hidden sm:flex overflow-x-auto scrollbar-hide px-4 md:px-6 -mb-px" aria-label="Tabs">
            <div class="flex space-x-4 md:space-x-8 min-w-max">
              <button
                (click)="setActiveTab('video')"
                [class.border-blue-500]="activeTab() === 'video'"
                [class.text-blue-600]="activeTab() === 'video'"
                [class.border-transparent]="activeTab() !== 'video'"
                [class.text-gray-500]="activeTab() !== 'video'"
                class="flex-shrink-0 whitespace-nowrap py-3 md:py-4 px-1 border-b-2 font-medium text-xs md:text-sm hover:text-blue-600 hover:border-blue-300 transition-colors">
                <i class="fas fa-play mr-1 md:mr-2"></i>
                <span class="hidden sm:inline">Video</span>
              </button>
              <button
                (click)="setActiveTab('resources')"
                [class.border-blue-500]="activeTab() === 'resources'"
                [class.text-blue-600]="activeTab() === 'resources'"
                [class.border-transparent]="activeTab() !== 'resources'"
                [class.text-gray-500]="activeTab() !== 'resources'"
                class="flex-shrink-0 whitespace-nowrap py-3 md:py-4 px-1 border-b-2 font-medium text-xs md:text-sm hover:text-blue-600 hover:border-blue-300 transition-colors">
                <i class="fas fa-paperclip mr-1 md:mr-2"></i>
                <span class="hidden md:inline">Resources</span>
                <span class="md:hidden">Res</span>
                @if ((lesson()?.resources?.length || 0) > 0) {
                  <span class="ml-1 md:ml-2 bg-blue-100 text-blue-800 text-xs font-medium px-1.5 md:px-2 py-0.5 md:py-1 rounded-full">{{ lesson()?.resources?.length || 0 }}</span>
                }
              </button>
              @if (hasQuizzes()) {
                <button
                  (click)="setActiveTab('quiz')"
                  [class.border-blue-500]="activeTab() === 'quiz'"
                  [class.text-blue-600]="activeTab() === 'quiz'"
                  [class.border-transparent]="activeTab() !== 'quiz'"
                  [class.text-gray-500]="activeTab() !== 'quiz'"
                  class="flex-shrink-0 whitespace-nowrap py-3 md:py-4 px-1 border-b-2 font-medium text-xs md:text-sm hover:text-blue-600 hover:border-blue-300 transition-colors">
                  <i class="fas fa-question-circle mr-1 md:mr-2"></i>
                  <span class="hidden md:inline">Quiz</span>
                  <span class="md:hidden">Q</span>
                  <span class="ml-1 md:ml-2 bg-green-100 text-green-800 text-xs font-medium px-1.5 md:px-2 py-0.5 md:py-1 rounded-full">{{ quizzes().length }}</span>
                </button>
              }
              <button
                (click)="setActiveTab('notes')"
                [class.border-blue-500]="activeTab() === 'notes'"
                [class.text-blue-600]="activeTab() === 'notes'"
                [class.border-transparent]="activeTab() !== 'notes'"
                [class.text-gray-500]="activeTab() !== 'notes'"
                class="flex-shrink-0 whitespace-nowrap py-3 md:py-4 px-1 border-b-2 font-medium text-xs md:text-sm hover:text-blue-600 hover:border-blue-300 transition-colors">
                <i class="fas fa-sticky-note mr-1 md:mr-2"></i>
                <span class="hidden md:inline">Notes</span>
                <span class="md:hidden">N</span>
                @if (notes().length > 0) {
                  <span class="ml-1 md:ml-2 bg-yellow-100 text-yellow-800 text-xs font-medium px-1.5 md:px-2 py-0.5 md:py-1 rounded-full">{{ notes().length }}</span>
                }
              </button>
              <button
                (click)="setActiveTab('qa')"
                [class.border-blue-500]="activeTab() === 'qa'"
                [class.text-blue-600]="activeTab() === 'qa'"
                [class.border-transparent]="activeTab() !== 'qa'"
                [class.text-gray-500]="activeTab() !== 'qa'"
                class="flex-shrink-0 whitespace-nowrap py-3 md:py-4 px-1 border-b-2 font-medium text-xs md:text-sm hover:text-blue-600 hover:border-blue-300 transition-colors">
                <i class="fas fa-comments mr-1 md:mr-2"></i>
                <span class="hidden md:inline">Q&A</span>
                <span class="md:hidden">Q&A</span>
              </button>
              <button
                (click)="setActiveTab('teacher')"
                [class.border-blue-500]="activeTab() === 'teacher'"
                [class.text-blue-600]="activeTab() === 'teacher'"
                [class.border-transparent]="activeTab() !== 'teacher'"
                [class.text-gray-500]="activeTab() !== 'teacher'"
                class="flex-shrink-0 whitespace-nowrap py-3 md:py-4 px-1 border-b-2 font-medium text-xs md:text-sm hover:text-blue-600 hover:border-blue-300 transition-colors">
                <i class="fas fa-chalkboard-teacher mr-1 md:mr-2"></i>
                <span class="hidden md:inline">Ask Teacher</span>
                <span class="md:hidden">Ask</span>
                @if (teacherQuestions().length > 0) {
                  <span class="ml-1 md:ml-2 bg-purple-100 text-purple-800 text-xs font-medium px-1.5 md:px-2 py-0.5 md:py-1 rounded-full">{{ teacherQuestions().length }}</span>
                }
              </button>
              @if (hasChapters()) {
                <button
                  (click)="setActiveTab('chapters')"
                  [class.border-blue-500]="activeTab() === 'chapters'"
                  [class.text-blue-600]="activeTab() === 'chapters'"
                  [class.border-transparent]="activeTab() !== 'chapters'"
                  [class.text-gray-500]="activeTab() !== 'chapters'"
                  class="flex-shrink-0 whitespace-nowrap py-3 md:py-4 px-1 border-b-2 font-medium text-xs md:text-sm hover:text-blue-600 hover:border-blue-300 transition-colors">
                  <i class="fas fa-list mr-1 md:mr-2"></i>
                  <span class="hidden md:inline">Chapters</span>
                  <span class="md:hidden">Ch</span>
                  <span class="ml-1 md:ml-2 bg-indigo-100 text-indigo-800 text-xs font-medium px-1.5 md:px-2 py-0.5 md:py-1 rounded-full">{{ videoChapters().length }}</span>
                </button>
              }
              @if (canEditContent()) {
                <button
                  (click)="setActiveTab('quiz-maker')"
                  [class.border-blue-500]="activeTab() === 'quiz-maker'"
                  [class.text-blue-600]="activeTab() === 'quiz-maker'"
                  [class.border-transparent]="activeTab() !== 'quiz-maker'"
                  [class.text-gray-500]="activeTab() !== 'quiz-maker'"
                  class="flex-shrink-0 whitespace-nowrap py-3 md:py-4 px-1 border-b-2 font-medium text-xs md:text-sm hover:text-blue-600 hover:border-blue-300 transition-colors">
                  <i class="fas fa-tools mr-1 md:mr-2"></i>
                  <span class="hidden md:inline">Quiz Maker</span>
                  <span class="md:hidden">QM</span>
                  @if (hasQuizMakers()) {
                    <span class="ml-1 md:ml-2 bg-orange-100 text-orange-800 text-xs font-medium px-1.5 md:px-2 py-0.5 md:py-1 rounded-full">{{ quizMakers().length }}</span>
                  }
                </button>
              }
            </div>
          </nav>
        </div>

        <!-- Tab Content -->
        <div class="p-4 md:p-6 lesson-content">

          <!-- Video Tab -->
          @if (activeTab() === 'video') {
            <div class="space-y-6">
              <!-- Video Player -->
              <div class="bg-black rounded-lg overflow-hidden video-container relative">
                @if (lesson()!.videoUrl) {
                  <video
                    #videoPlayer
                    class="w-full aspect-video"
                    controls
                    [poster]="getVideoPosterUrl()"
                    preload="metadata"
                    (timeupdate)="onVideoTimeUpdate($event)"
                    (play)="onVideoPlay()"
                    (pause)="onVideoPause()"
                    (loadedmetadata)="onVideoLoadedMetadata($event)"
                    (error)="onVideoError($event)"
                    (click)="onVideoClick($event)">
                    <source [src]="lesson()!.videoUrl" type="video/mp4">
                    <p class="text-white p-4">
                      Your browser does not support the video tag.
                      <a [href]="lesson()!.videoUrl" class="text-blue-400 underline" download>
                        Download the video
                      </a>
                    </p>
                  </video>

                  <!-- Custom Play Button Overlay -->
                  @if (!isVideoPlaying()) {
                    <div class="video-overlay show" (click)="playVideo()">
                      <div class="play-button">
                        <i class="fas fa-play"></i>
                      </div>
                    </div>
                  }

                  <!-- Video Info Overlay -->
                  <div class="absolute top-4 left-4 right-4 text-white">
                    <div class="bg-black bg-opacity-50 rounded-lg p-3 backdrop-blur-sm">
                      <h3 class="font-semibold text-lg mb-1">{{ lesson()!.title }}</h3>
                      <p class="text-sm opacity-90">{{ lesson()!.duration }} minutes ‚Ä¢ {{ lesson()!.difficulty }}</p>
                    </div>
                  </div>
                } @else {
                  <!-- No Video Available -->
                  <div class="video-poster-fallback">
                    <div class="text-center">
                      <i class="fas fa-video block"></i>
                      <p>Video not available</p>
                      <p class="text-sm opacity-75 mt-2">This lesson doesn't have a video yet</p>
                    </div>
                  </div>
                }
              </div>

              <!-- Video Progress -->
              @if (videoDuration() > 0) {
                <div class="bg-gray-100 rounded-lg p-4">
                  <div class="flex items-center justify-between text-sm text-gray-600 mb-2">
                    <span>{{ formatTime(videoCurrentTime()) }}</span>
                    @if (currentChapter()) {
                      <span class="text-blue-600 font-medium">{{ currentChapter()!.title }}</span>
                    }
                    <span>{{ formatTime(videoDuration()) }}</span>
                  </div>

                  <!-- Enhanced Progress Bar with Chapter Markers -->
                  <div class="relative video-progress-bar">
                    <!-- Main Progress Bar -->
                    <div
                      class="w-full bg-gray-300 rounded-full h-3 cursor-pointer hover:h-4 transition-all duration-200"
                      (click)="onProgressBarClick($event)">

                      <!-- Progress Fill -->
                      <div
                        class="progress-fill bg-blue-600 h-full rounded-full transition-all duration-200 relative"
                        [style.width.%]="videoProgress()">
                      </div>

                      <!-- Chapter Markers -->
                      @if (hasChapters()) {
                        @for (chapter of videoChapters(); track chapter.id) {
                          <div
                            class="chapter-marker"
                            [style.left.%]="getChapterPosition(chapter)"
                            (click)="jumpToChapter(chapter); $event.stopPropagation()">

                            <!-- Chapter Tooltip -->
                            <div class="chapter-tooltip">
                              <div class="font-medium">{{ chapter.title }}</div>
                              <div class="text-gray-300">{{ formatSecondsToTime(chapter.startTime) }}</div>
                            </div>
                          </div>
                        }
                      }

                      <!-- Current Time Indicator -->
                      <div
                        class="time-indicator"
                        [style.left.%]="videoProgress()">
                      </div>
                    </div>

                    <!-- Chapter Segments Background -->
                    @if (hasChapters()) {
                      <div class="absolute top-0 w-full h-3 rounded-full overflow-hidden -z-10">
                        @for (chapter of videoChapters(); track chapter.id; let i = $index) {
                          <div
                            class="chapter-segment"
                            [class]="'bg-' + getChapterColor(i)"
                            [style.left.%]="getChapterPosition(chapter)"
                            [style.width.%]="getChapterWidth(chapter)">
                          </div>
                        }
                      </div>
                    }
                  </div>

                  <!-- Chapter Progress Info -->
                  @if (currentChapter()) {
                    <div class="mt-2 text-xs text-gray-600 flex items-center justify-between">
                      <span>Chapter {{ getCurrentChapterIndex() + 1 }} of {{ videoChapters().length }}</span>
                      <span>{{ formatSecondsToTime(currentChapter()!.startTime) }} - {{ formatSecondsToTime(currentChapter()!.endTime) }}</span>
                    </div>
                  }
                </div>
              }

              <!-- Video Chapters Navigation -->
              @if (hasChapters()) {
                <div class="bg-gray-50 rounded-lg p-4">
                  <h4 class="text-md font-semibold text-gray-900 mb-3">Video Chapters</h4>
                  <div class="space-y-2">
                    @for (chapter of videoChapters(); track chapter.id) {
                      <button
                        (click)="jumpToChapter(chapter)"
                        [class.bg-blue-100]="currentChapter()?.id === chapter.id"
                        [class.border-blue-500]="currentChapter()?.id === chapter.id"
                        [class.bg-white]="currentChapter()?.id !== chapter.id"
                        [class.border-gray-200]="currentChapter()?.id !== chapter.id"
                        class="w-full text-left p-3 border rounded-lg hover:bg-blue-50 transition-colors duration-200">
                        <div class="flex items-center justify-between">
                          <div class="flex-1">
                            <div class="font-medium text-gray-900">{{ chapter.title }}</div>
                            @if (chapter.description) {
                              <div class="text-sm text-gray-600">{{ chapter.description }}</div>
                            }
                          </div>
                          <div class="text-sm text-blue-600 font-medium ml-4">
                            {{ formatSecondsToTime(chapter.startTime) }}
                          </div>
                        </div>
                      </button>
                    }
                  </div>
                </div>
              }

              <!-- Learning Objectives -->
              @if (lesson()!.learningObjectives && lesson()!.learningObjectives!.length > 0) {
                <div class="bg-blue-50 rounded-lg p-6">
                  <h3 class="text-lg font-semibold text-blue-900 mb-4">Learning Objectives</h3>
                  <ul class="space-y-2">
                    @for (objective of lesson()!.learningObjectives!; track objective) {
                      <li class="flex items-start">
                        <i class="fas fa-check-circle text-blue-600 mt-1 mr-3"></i>
                        <span class="text-blue-800">{{ objective }}</span>
                      </li>
                    }
                  </ul>
                </div>
              }
            </div>
          }

          <!-- Resources Tab -->
          @if (activeTab() === 'resources') {
            <div class="space-y-6">
              <h3 class="text-xl font-semibold text-gray-900">Lesson Resources</h3>

              @if (lesson()!.resources.length > 0) {
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                  @for (resource of lesson()!.resources; track resource.id) {
                    <div class="bg-gray-50 rounded-lg p-4 hover:bg-gray-100 transition-colors duration-200">
                      <div class="flex items-start justify-between">
                        <div class="flex-1">
                          <div class="flex items-center mb-2">
                            <i [class]="getResourceIcon(resource.type || 'PDF') + ' ' + getResourceColor(resource.type || 'PDF') + ' mr-2'"></i>
                            <span class="text-sm font-medium text-gray-700 uppercase">{{ resource.type || 'PDF' }}</span>
                          </div>
                          <h4 class="font-semibold text-gray-900 mb-2">{{ resource.name }}</h4>
                          <button
                            (click)="downloadResource(resource)"
                            class="text-blue-600 hover:text-blue-800 text-sm font-medium flex items-center">
                            @if (resource.downloadable) {
                              <i class="fas fa-download mr-1"></i>
                              Download
                            } @else {
                              <i class="fas fa-external-link-alt mr-1"></i>
                              Open
                            }
                          </button>
                        </div>
                      </div>
                    </div>
                  }
                </div>
              } @else {
                <div class="text-center py-8">
                  <i class="fas fa-folder-open text-4xl text-gray-400 mb-4"></i>
                  <p class="text-gray-600">No resources available for this lesson</p>
                </div>
              }
            </div>
          }

          <!-- Quiz Tab -->
          @if (activeTab() === 'quiz' && hasQuizzes()) {
            <div class="space-y-6">
              @if (!showQuizResults()) {
                <!-- Quiz Progress -->
                <div class="flex items-center justify-between mb-6">
                  <h3 class="text-xl font-semibold text-gray-900">Lesson Quiz</h3>
                  <div class="text-sm text-gray-600">
                    Question {{ currentQuizIndex() + 1 }} of {{ quizzes().length }}
                  </div>
                </div>

                <div class="w-full bg-gray-200 rounded-full h-2 mb-6">
                  <div
                    class="bg-green-600 h-2 rounded-full transition-all duration-300"
                    [style.width.%]="quizProgress()">
                  </div>
                </div>

                <!-- Current Quiz Question -->
                @if (currentQuiz()) {
                  <div class="bg-white border border-gray-200 rounded-lg p-6">
                    <h4 class="text-lg font-semibold text-gray-900 mb-4">{{ currentQuiz()!.question }}</h4>

                    <div class="space-y-3">
                      @for (option of currentQuiz()!.options; track $index; let i = $index) {
                        <button
                          (click)="selectQuizAnswer(i)"
                          [class.border-blue-500]="quizAnswers()[currentQuizIndex()] === i"
                          [class.bg-blue-50]="quizAnswers()[currentQuizIndex()] === i"
                          [class.border-gray-300]="quizAnswers()[currentQuizIndex()] !== i"
                          class="w-full text-left p-4 border-2 rounded-lg hover:border-blue-300 transition-colors duration-200">
                          <div class="flex items-center">
                            <span class="flex-shrink-0 w-6 h-6 rounded-full border-2 mr-3 flex items-center justify-center text-sm font-medium"
                                  [class.border-blue-500]="quizAnswers()[currentQuizIndex()] === i"
                                  [class.bg-blue-500]="quizAnswers()[currentQuizIndex()] === i"
                                  [class.text-white]="quizAnswers()[currentQuizIndex()] === i"
                                  [class.border-gray-300]="quizAnswers()[currentQuizIndex()] !== i">
                              {{ getOptionLetter(i) }}
                            </span>
                            <span>{{ option }}</span>
                          </div>
                        </button>
                      }
                    </div>

                    <!-- Quiz Navigation -->
                    <div class="flex justify-between mt-6">
                      <button
                        (click)="previousQuiz()"
                        [disabled]="currentQuizIndex() === 0"
                        class="px-4 py-2 text-gray-600 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                        Previous
                      </button>

                      @if (currentQuizIndex() < quizzes().length - 1) {
                        <button
                          (click)="nextQuiz()"
                          [disabled]="quizAnswers()[currentQuizIndex()] === -1"
                          class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                          Next
                        </button>
                      } @else {
                        <button
                          (click)="finishQuiz()"
                          [disabled]="quizAnswers()[currentQuizIndex()] === -1"
                          class="px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                          Finish Quiz
                        </button>
                      }
                    </div>
                  </div>
                }
              } @else {
                <!-- Quiz Results -->
                <div class="text-center space-y-6">
                  <div class="inline-flex items-center justify-center w-20 h-20 rounded-full"
                         [class.bg-green-100]="quizScore() >= 70"
                         [class.bg-yellow-100]="quizScore() >= 50 && quizScore() < 70"
                         [class.bg-red-100]="quizScore() < 50">
                    <i class="text-3xl"
                         [class.fas]="true"
                         [class.fa-trophy]="quizScore() >= 70"
                         [class.text-green-600]="quizScore() >= 70"
                         [class.fa-medal]="quizScore() >= 50 && quizScore() < 70"
                         [class.text-yellow-600]="quizScore() >= 50 && quizScore() < 70"
                         [class.fa-times-circle]="quizScore() < 50"
                         [class.text-red-600]="quizScore() < 50"></i>
                  </div>

                  <div>
                    <h3 class="text-2xl font-bold text-gray-900">Quiz Complete!</h3>
                    <p class="text-lg text-gray-600 mt-2">Your Score: {{ quizScore() }}%</p>

                    @if (quizScore() >= 70) {
                      <p class="text-green-600 font-medium mt-2">Excellent work! You've mastered this lesson.</p>
                    } @else if (quizScore() >= 50) {
                      <p class="text-yellow-600 font-medium mt-2">Good job! Consider reviewing the material once more.</p>
                    } @else {
                      <p class="text-red-600 font-medium mt-2">You might want to review the lesson and try again.</p>
                    }
                  </div>

                  <button
                    (click)="resetQuiz()"
                    class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                    Retake Quiz
                  </button>
                </div>
              }
            </div>
          }

          <!-- Notes Tab -->
          @if (activeTab() === 'notes') {
            <div class="space-y-6">
              <div class="flex items-center justify-between">
                <h3 class="text-xl font-semibold text-gray-900">Lesson Notes</h3>
                <div class="text-sm text-gray-600">
                  Click on timestamps to jump to that part of the video
                </div>
              </div>

              <!-- Add Note Form -->
              <form [formGroup]="noteForm" (ngSubmit)="addNote()" class="bg-blue-50 rounded-lg p-4">
                <div class="mb-4">
                  <label class="block text-sm font-medium text-blue-900 mb-2">Add a note at {{ formatTimestamp(videoCurrentTime()) }}</label>
                  <textarea
                    formControlName="content"
                    rows="3"
                    class="w-full px-3 py-2 border border-blue-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"
                    placeholder="Enter your note here..."></textarea>
                </div>
                <button
                  type="submit"
                  [disabled]="noteForm.invalid || isAddingNote()"
                  class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                  <i class="fas fa-plus mr-2"></i>
                  Add Note
                </button>
              </form>

              <!-- Notes List -->
              @if (notes().length > 0) {
                <div class="space-y-4">
                  @for (note of notes(); track note.id) {
                    <div class="bg-white border border-gray-200 rounded-lg p-4">
                      <div class="flex items-start justify-between">
                        <div class="flex-1">
                          <div class="flex items-center gap-2 mb-2">
                            <button
                              (click)="seekToTime(note.timestamp)"
                              class="text-blue-600 hover:text-blue-800 font-medium text-sm">
                              <i class="fas fa-play mr-1"></i>
                              {{ formatTimestamp(note.timestamp) }}
                            </button>
                            <span class="text-gray-500 text-xs">{{ note.createdAt | date:'short' }}</span>
                          </div>
                          <p class="text-gray-800">{{ note.content }}</p>
                        </div>
                        <button
                          (click)="deleteNote(note.id)"
                          class="text-red-600 hover:text-red-800 ml-4">
                          <i class="fas fa-trash text-sm"></i>
                        </button>
                      </div>
                    </div>
                  }
                </div>
              } @else {
                <div class="text-center py-8">
                  <i class="fas fa-sticky-note text-4xl text-gray-400 mb-4"></i>
                  <p class="text-gray-600">No notes yet. Add your first note above!</p>
                </div>
              }
            </div>
          }

          <!-- Q&A Tab -->
          @if (activeTab() === 'qa' && lesson()) {
            <app-lesson-qa [lessonId]="lesson()!.id" />
          }

          <!-- Teacher Interaction Tab -->
          @if (activeTab() === 'teacher') {
            <div class="space-y-6">
              <h3 class="text-xl font-semibold text-gray-900">Ask Your Teacher</h3>

              <!-- Ask Question Form -->
              <form [formGroup]="questionForm" (ngSubmit)="askTeacher()" class="bg-purple-50 rounded-lg p-4">
                <div class="mb-4">
                  <label class="block text-sm font-medium text-purple-900 mb-2">What would you like to ask about this lesson?</label>
                  <textarea
                    formControlName="question"
                    rows="3"
                    class="w-full px-3 py-2 border border-purple-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent resize-none"
                    placeholder="Type your question here..."></textarea>
                </div>
                <button
                  type="submit"
                  [disabled]="questionForm.invalid || isAskingQuestion()"
                  class="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                  <i class="fas fa-paper-plane mr-2"></i>
                  Ask Teacher
                </button>
              </form>

              <!-- Questions & Answers -->
              @if (teacherQuestions().length > 0) {
                <div class="space-y-4">
                  <h4 class="text-lg font-semibold text-gray-900">Previous Questions</h4>
                  @for (question of teacherQuestions(); track question.id) {
                    <div class="bg-white border border-gray-200 rounded-lg overflow-hidden">
                      <!-- Question -->
                      <div class="p-4 bg-gray-50">
                        <div class="flex items-start justify-between">
                          <div class="flex-1">
                            <div class="flex items-center gap-2 mb-2">
                              <i class="fas fa-user-circle text-blue-600"></i>
                              <span class="font-medium text-gray-900">You</span>
                              <span class="text-gray-500 text-sm">{{ question.askedAt | date:'short' }}</span>
                            </div>
                            <p class="text-gray-800">{{ question.question }}</p>
                          </div>
                          @if (question.isAnswered) {
                            <span class="bg-green-100 text-green-800 text-xs font-medium px-2 py-1 rounded-full">Answered</span>
                          } @else {
                            <span class="bg-yellow-100 text-yellow-800 text-xs font-medium px-2 py-1 rounded-full">Pending</span>
                          }
                        </div>
                      </div>

                      <!-- Answer -->
                      @if (question.isAnswered && question.answer) {
                        <div class="p-4">
                          <div class="flex items-start gap-2 mb-2">
                            <i class="fas fa-chalkboard-teacher text-purple-600"></i>
                            <span class="font-medium text-gray-900">Teacher</span>
                            <span class="text-gray-500 text-sm">{{ question.answeredAt | date:'short' }}</span>
                          </div>
                          <p class="text-gray-800 ml-6">{{ question.answer }}</p>
                        </div>
                      } @else {
                        <div class="p-4 bg-yellow-50">
                          <p class="text-yellow-800 text-sm">
                            <i class="fas fa-clock mr-2"></i>
                            Your teacher will respond soon. You'll be notified when they answer.
                          </p>
                        </div>
                      }
                    </div>
                  }
                </div>
              } @else {
                <div class="text-center py-8">
                  <i class="fas fa-chalkboard-teacher text-4xl text-gray-400 mb-4"></i>
                  <p class="text-gray-600">No questions yet. Ask your first question above!</p>
                </div>
              }
            </div>
          }

          <!-- Chapters Tab -->
          @if (activeTab() === 'chapters') {
            <div class="space-y-6">
              <div class="flex items-center justify-between">
                <h3 class="text-xl font-semibold text-gray-900">Video Chapters</h3>
                @if (canEditContent()) {
                  <button
                    (click)="toggleChapterEditing()"
                    class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors duration-200">
                    <i class="fas fa-plus mr-2"></i>
                    {{ isEditingChapters() ? 'Cancel' : 'Add Chapter' }}
                  </button>
                }
              </div>

              <!-- Add Chapter Form -->
              @if (isEditingChapters() && canEditContent()) {
                <form [formGroup]="chapterForm" (ngSubmit)="addChapter()" class="bg-indigo-50 rounded-lg p-4">
                  <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                      <label class="block text-sm font-medium text-indigo-900 mb-2">Chapter Title</label>
                      <input
                        formControlName="title"
                        type="text"
                        class="w-full px-3 py-2 border border-indigo-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                        placeholder="Enter chapter title">
                    </div>
                    <div>
                      <label class="block text-sm font-medium text-indigo-900 mb-2">Description</label>
                      <input
                        formControlName="description"
                        type="text"
                        class="w-full px-3 py-2 border border-indigo-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                        placeholder="Chapter description (optional)">
                    </div>
                    <div>
                      <label class="block text-sm font-medium text-indigo-900 mb-2">Start Time (seconds)</label>
                      <input
                        formControlName="startTime"
                        type="number"
                        min="0"
                        class="w-full px-3 py-2 border border-indigo-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                        placeholder="0">
                    </div>
                    <div>
                      <label class="block text-sm font-medium text-indigo-900 mb-2">End Time (seconds)</label>
                      <input
                        formControlName="endTime"
                        type="number"
                        min="0"
                        class="w-full px-3 py-2 border border-indigo-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                        placeholder="0">
                    </div>
                  </div>
                  <button
                    type="submit"
                    [disabled]="chapterForm.invalid"
                    class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                    <i class="fas fa-save mr-2"></i>
                    Save Chapter
                  </button>
                </form>
              }

              <!-- Chapters List -->
              @if (hasChapters()) {
                <div class="space-y-4">
                  @for (chapter of videoChapters(); track chapter.id) {
                    <div class="bg-white border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow duration-200">
                      <div class="flex items-center justify-between">
                        <div class="flex-1">
                          <div class="flex items-center gap-3">
                            <button
                              (click)="jumpToChapter(chapter)"
                              class="text-blue-600 hover:text-blue-800 font-medium">
                              <i class="fas fa-play mr-1"></i>
                              {{ formatSecondsToTime(chapter.startTime) }} - {{ formatSecondsToTime(chapter.endTime) }}
                            </button>
                            <span class="font-semibold text-gray-900">{{ chapter.title }}</span>
                          </div>
                          @if (chapter.description) {
                            <p class="text-gray-600 mt-1">{{ chapter.description }}</p>
                          }
                        </div>
                        @if (canEditContent()) {
                          <div class="flex items-center gap-2">
                            <button
                              (click)="editChapter(chapter)"
                              class="text-blue-600 hover:text-blue-800 p-2">
                              <i class="fas fa-edit"></i>
                            </button>
                            <button
                              (click)="deleteChapter(chapter.id)"
                              class="text-red-600 hover:text-red-800 p-2">
                              <i class="fas fa-trash"></i>
                            </button>
                          </div>
                        }
                      </div>
                    </div>
                  }
                </div>
              } @else {
                <div class="text-center py-8">
                  <i class="fas fa-list text-4xl text-gray-400 mb-4"></i>
                  <p class="text-gray-600">No chapters available. Add chapters to organize your video content.</p>
                </div>
              }
            </div>
          }

          <!-- Quiz Maker Tab -->
          @if (activeTab() === 'quiz-maker' && canEditContent()) {
            <div class="space-y-8">

              <!-- Lesson Management Section -->
              <div class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl p-6 border border-blue-100">
                <div class="flex items-center justify-between mb-6">
                  <div>
                    <h3 class="text-xl font-semibold text-gray-900 mb-2">Lesson Settings</h3>
                    <p class="text-gray-600 text-sm">Manage video poster and lesson properties</p>
                  </div>
                  <i class="fas fa-cog text-2xl text-blue-500"></i>
                </div>

                <!-- Video Poster Management -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                  <!-- Current Poster Preview -->
                  <div>
                    <h4 class="font-semibold text-gray-800 mb-3">Current Video Poster</h4>
                    <div class="relative bg-gray-900 rounded-lg overflow-hidden">
                      @if (getVideoPosterUrl()) {
                        <img
                          [src]="getVideoPosterUrl()"
                          [alt]="'Poster for ' + lesson()!.title"
                          class="w-full aspect-video object-cover"
                          (error)="onPosterImageError($event)">
                      } @else {
                        <div class="aspect-video flex items-center justify-center bg-gray-700">
                          <div class="text-center text-gray-300">
                            <i class="fas fa-image text-3xl mb-2"></i>
                            <p>No poster set</p>
                          </div>
                        </div>
                      }
                      <!-- Play button overlay -->
                      <div class="absolute inset-0 flex items-center justify-center">
                        <div class="w-16 h-16 bg-white bg-opacity-90 rounded-full flex items-center justify-center">
                          <i class="fas fa-play text-gray-800 text-xl ml-1"></i>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Poster URL Management -->
                  <div>
                    <h4 class="font-semibold text-gray-800 mb-3">Update Video Poster</h4>
                    <div class="space-y-4">
                      <!-- Poster URL Input -->
                      <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                          Poster Image URL
                        </label>
                        <input
                          type="url"
                          [value]="lesson()!.posterUrl || ''"
                          (input)="updatePosterUrl($any($event.target).value)"
                          placeholder="https://example.com/video-poster.jpg"
                          class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm">
                      </div>

                      <!-- Quick Actions -->
                      <div class="flex gap-2">
                        <button
                          (click)="generatePosterFromThumbnail()"
                          class="flex-1 bg-blue-100 text-blue-700 px-3 py-2 rounded-lg hover:bg-blue-200 transition-colors duration-200 text-sm">
                          <i class="fas fa-magic mr-1"></i>
                          Use Thumbnail
                        </button>
                        <button
                          (click)="clearPoster()"
                          class="flex-1 bg-red-100 text-red-700 px-3 py-2 rounded-lg hover:bg-red-200 transition-colors duration-200 text-sm">
                          <i class="fas fa-trash mr-1"></i>
                          Clear Poster
                        </button>
                      </div>

                      <!-- Poster Guidelines -->
                      <div class="bg-blue-50 rounded-lg p-3 text-sm">
                        <p class="text-blue-800 font-medium mb-1">Poster Guidelines:</p>
                        <ul class="text-blue-700 space-y-1 text-xs">
                          <li>‚Ä¢ Recommended size: 1280x720 pixels (16:9 aspect ratio)</li>
                          <li>‚Ä¢ Format: JPG, PNG, or WebP</li>
                          <li>‚Ä¢ File size: Under 500KB for fast loading</li>
                          <li>‚Ä¢ High contrast for better visibility</li>
                        </ul>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Save Changes Button -->
                <div class="mt-6 flex justify-end">
                  <button
                    (click)="saveLessonSettings()"
                    class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition-colors duration-200 flex items-center">
                    <i class="fas fa-save mr-2"></i>
                    Save Changes
                  </button>
                </div>
              </div>

              <!-- Quiz Management Section -->
              <div class="space-y-6">
                <div class="flex items-center justify-between">
                  <h3 class="text-xl font-semibold text-gray-900">Quiz Management</h3>
                  @if (!isCreatingQuiz()) {
                    <button
                      (click)="startCreatingQuiz()"
                      class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors duration-200">
                      <i class="fas fa-plus mr-2"></i>
                      Create New Quiz
                    </button>
                  }
                </div>

                <!-- Quiz Creation Form -->
                @if (isCreatingQuiz()) {
                  <div class="bg-orange-50 rounded-lg p-6">
                    <div class="flex items-center justify-between mb-4">
                      <h4 class="text-lg font-semibold text-orange-900">
                        {{ isEditingQuiz() ? 'Edit Quiz' : 'Create New Quiz' }}
                      </h4>
                      <button
                        (click)="cancelQuizCreation()"
                        class="text-orange-600 hover:text-orange-800">
                        <i class="fas fa-times"></i>
                      </button>
                    </div>

                    <!-- Quiz Basic Info -->
                    <form [formGroup]="quizMakerForm" class="space-y-4 mb-6">
                      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                          <label class="block text-sm font-medium text-orange-900 mb-2">Quiz Title</label>
                          <input
                            formControlName="title"
                            type="text"
                            class="w-full px-3 py-2 border border-orange-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent"
                            placeholder="Enter quiz title">
                        </div>
                        <div>
                          <label class="block text-sm font-medium text-orange-900 mb-2">Time Limit (minutes)</label>
                          <input
                            formControlName="timeLimit"
                            type="number"
                            min="1"
                            class="w-full px-3 py-2 border border-orange-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent"
                            placeholder="30">
                        </div>
                        <div class="md:col-span-2">
                          <label class="block text-sm font-medium text-orange-900 mb-2">Description</label>
                          <textarea
                            formControlName="description"
                            rows="3"
                            class="w-full px-3 py-2 border border-orange-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent resize-none"
                            placeholder="Enter quiz description"></textarea>
                        </div>
                        <div>
                          <label class="block text-sm font-medium text-orange-900 mb-2">Passing Score (%)</label>
                          <input
                            formControlName="passingScore"
                            type="number"
                            min="0"
                            max="100"
                            class="w-full px-3 py-2 border border-orange-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent"
                            placeholder="70">
                        </div>
                        <div class="flex items-center">
                          <input
                            formControlName="isActive"
                            type="checkbox"
                            class="h-4 w-4 text-orange-600 focus:ring-orange-500 border-gray-300 rounded">
                          <label class="ml-2 text-sm text-orange-900">Active</label>
                        </div>
                      </div>
                    </form>

                    <!-- Add Questions Section -->
                    <div class="border-t border-orange-200 pt-6">
                      <h5 class="text-md font-semibold text-orange-900 mb-4">Add Questions</h5>

                      <form [formGroup]="quizQuestionForm" (ngSubmit)="addQuestionToQuiz()" class="space-y-4 mb-6">
                        <div>
                          <label class="block text-sm font-medium text-orange-900 mb-2">Question</label>
                          <textarea
                            formControlName="question"
                            rows="2"
                            class="w-full px-3 py-2 border border-orange-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent resize-none"
                            placeholder="Enter your question"></textarea>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                          <div>
                            <label class="block text-sm font-medium text-orange-900 mb-2">Option A</label>
                            <input
                              formControlName="option1"
                              type="text"
                              class="w-full px-3 py-2 border border-orange-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent"
                              placeholder="Option A">
                          </div>
                          <div>
                            <label class="block text-sm font-medium text-orange-900 mb-2">Option B</label>
                            <input
                              formControlName="option2"
                              type="text"
                              class="w-full px-3 py-2 border border-orange-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent"
                              placeholder="Option B">
                          </div>
                          <div>
                            <label class="block text-sm font-medium text-orange-900 mb-2">Option C</label>
                            <input
                              formControlName="option3"
                              type="text"
                              class="w-full px-3 py-2 border border-orange-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent"
                              placeholder="Option C">
                          </div>
                          <div>
                            <label class="block text-sm font-medium text-orange-900 mb-2">Option D</label>
                            <input
                              formControlName="option4"
                              type="text"
                              class="w-full px-3 py-2 border border-orange-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent"
                              placeholder="Option D">
                          </div>
                          <div>
                            <label class="block text-sm font-medium text-orange-900 mb-2">Correct Answer</label>
                            <select
                              formControlName="correctAnswer"
                              class="w-full px-3 py-2 border border-orange-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent">
                              <option value="0">Option A</option>
                              <option value="1">Option B</option>
                              <option value="2">Option C</option>
                              <option value="3">Option D</option>
                            </select>
                          </div>
                          <div>
                            <label class="block text-sm font-medium text-orange-900 mb-2">Points</label>
                            <input
                              formControlName="points"
                              type="number"
                              min="1"
                              class="w-full px-3 py-2 border border-orange-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent"
                              placeholder="1">
                          </div>
                        </div>
                        <div>
                          <label class="block text-sm font-medium text-orange-900 mb-2">Explanation (Optional)</label>
                          <textarea
                            formControlName="explanation"
                            rows="2"
                            class="w-full px-3 py-2 border border-orange-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent resize-none"
                            placeholder="Explain why this is the correct answer"></textarea>
                        </div>
                        <button
                          type="submit"
                          [disabled]="quizQuestionForm.invalid"
                          class="bg-orange-600 text-white px-4 py-2 rounded-lg hover:bg-orange-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                          <i class="fas fa-plus mr-2"></i>
                          Add Question
                        </button>
                      </form>

                      <!-- Questions List -->
                      @if (currentQuizMaker()?.questions && currentQuizMaker()!.questions.length > 0) {
                        <div class="space-y-3">
                          <h6 class="text-sm font-semibold text-orange-900">Questions ({{ currentQuizMaker()!.questions.length }}) - Total Points: {{ getTotalQuizPoints() }}</h6>
                          @for (question of currentQuizMaker()!.questions; track question.id; let i = $index) {
                            <div class="bg-white border border-orange-200 rounded-lg p-4">
                              <div class="flex items-start justify-between">
                                <div class="flex-1">
                                  <div class="font-medium text-gray-900 mb-2">{{ i + 1 }}. {{ question.question }}</div>
                                  <div class="grid grid-cols-2 gap-2 text-sm">
                                    @for (option of question.options; track $index; let j = $index) {
                                      <div class="flex items-center">
                                        <span
                                          [class.text-green-600]="j === question.correctAnswer"
                                          [class.font-semibold]="j === question.correctAnswer"
                                          class="text-gray-700">
                                          {{ getOptionLetter(j) }}. {{ option }}
                                          @if (j === question.correctAnswer) {
                                            <i class="fas fa-check text-green-600 ml-1"></i>
                                          }
                                        </span>
                                      </div>
                                    }
                                  </div>
                                  @if (question.explanation) {
                                    <div class="text-sm text-gray-600 mt-2">
                                      <strong>Explanation:</strong> {{ question.explanation }}
                                    </div>
                                  }
                                  <div class="text-sm text-orange-600 font-medium mt-1">Points: {{ question.points }}</div>
                                </div>
                                <button
                                  (click)="removeQuestionFromQuiz(question.id)"
                                  class="text-red-600 hover:text-red-800 ml-4">
                                  <i class="fas fa-trash"></i>
                                </button>
                              </div>
                            </div>
                          }
                        </div>
                      }

                      <!-- Save Quiz Button -->
                      <div class="flex items-center gap-4 mt-6 pt-4 border-t border-orange-200">
                        <button
                          (click)="saveQuiz()"
                          [disabled]="quizMakerForm.invalid || !currentQuizMaker()?.questions?.length"
                          class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                          <i class="fas fa-save mr-2"></i>
                          {{ isEditingQuiz() ? 'Update Quiz' : 'Save Quiz' }}
                        </button>
                        <button
                          (click)="cancelQuizCreation()"
                          class="bg-gray-600 text-white px-6 py-2 rounded-lg hover:bg-gray-700 transition-colors">
                          Cancel
                        </button>
                      </div>
                    </div>
                  </div>
                } @else {
                  <!-- Existing Quizzes -->
                  @if (hasQuizMakers()) {
                    <div class="space-y-4">
                      <h4 class="text-lg font-semibold text-gray-900">Existing Quizzes</h4>
                      @for (quiz of quizMakers(); track quiz.id) {
                        <div class="bg-white border border-gray-200 rounded-lg p-6 hover:shadow-md transition-shadow duration-200">
                          <div class="flex items-start justify-between">
                            <div class="flex-1">
                              <div class="flex items-center gap-3 mb-2">
                                <h5 class="text-lg font-semibold text-gray-900">{{ quiz.title }}</h5>
                                <span
                                  [class.bg-green-100]="quiz.isActive"
                                  [class.text-green-800]="quiz.isActive"
                                  [class.bg-gray-100]="!quiz.isActive"
                                  [class.text-gray-800]="!quiz.isActive"
                                  class="px-2 py-1 rounded-full text-xs font-medium">
                                  {{ quiz.isActive ? 'Active' : 'Inactive' }}
                                </span>
                              </div>
                              <p class="text-gray-600 mb-3">{{ quiz.description }}</p>
                              <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
                                <div>
                                  <span class="text-gray-500">Questions:</span>
                                  <span class="font-medium text-gray-900 ml-1">{{ quiz.questions.length }}</span>
                                </div>
                                <div>
                                  <span class="text-gray-500">Time Limit:</span>
                                  <span class="font-medium text-gray-900 ml-1">{{ quiz.timeLimit }}min</span>
                                </div>
                                <div>
                                  <span class="text-gray-500">Passing Score:</span>
                                  <span class="font-medium text-gray-900 ml-1">{{ quiz.passingScore }}%</span>
                                </div>
                                <div>
                                  <span class="text-gray-500">Total Points:</span>
                                  <span class="font-medium text-gray-900 ml-1">{{ getQuizTotalPoints(quiz) }}</span>
                                </div>
                              </div>
                              <div class="text-xs text-gray-500 mt-2">
                                Created by {{ quiz.createdBy }} on {{ quiz.createdAt | date:'short' }}
                              </div>
                            </div>
                            <div class="flex items-center gap-2 ml-4">
                              <button
                                (click)="toggleQuizStatus(quiz.id)"
                                [class.bg-green-600]="!quiz.isActive"
                                [class.bg-gray-600]="quiz.isActive"
                                class="text-white px-3 py-1 rounded text-sm hover:opacity-80 transition-opacity">
                                {{ quiz.isActive ? 'Deactivate' : 'Activate' }}
                              </button>
                              <button
                                (click)="editQuiz(quiz)"
                                class="text-blue-600 hover:text-blue-800 p-2">
                                <i class="fas fa-edit"></i>
                              </button>
                              <button
                                (click)="deleteQuiz(quiz.id)"
                                class="text-red-600 hover:text-red-800 p-2">
                                <i class="fas fa-trash"></i>
                              </button>
                            </div>
                          </div>
                        </div>
                      }
                    </div>
                  } @else {
                    <div class="text-center py-8">
                      <i class="fas fa-clipboard-list text-4xl text-gray-400 mb-4"></i>
                      <p class="text-gray-600">No quizzes created yet. Create your first quiz above!</p>
                    </div>
                  }
                }
              </div>
            </div>
          }

        </div>
      </div>
    }

  </div>
</div>
