<!-- Add Student Component -->
<div class="min-h-screen bg-gray-50 py-8">
  <div class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8">

    <!-- Header -->
    <div class="mb-8 text-center">
      <h1 class="text-3xl font-bold text-gray-900">Add New Student</h1>
      <p class="mt-2 text-sm text-gray-600">Register your child and link them to your account</p>
    </div>

    <!-- Form Card -->
    <div class="bg-white rounded-lg shadow-md p-8">
      <form [formGroup]="addStudentForm" (ngSubmit)="onSubmit()" class="space-y-6" novalidate>

        <!-- Username -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">
            Student Username <span class="text-red-500">*</span>
          </label>
          <input
            type="text"
            formControlName="userName"
            class="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all"
            [class.border-red-500]="hasError('userName', 'required') || hasError('userName', 'minlength')"
            [class.border-gray-300]="!hasError('userName', 'required') && !hasError('userName', 'minlength')"
            placeholder="e.g., ahmed_hassan" />
          @if (hasError('userName', 'required')) {
            <p class="mt-1 text-sm text-red-500">Username is required</p>
          }
          @if (hasError('userName', 'minlength')) {
            <p class="mt-1 text-sm text-red-500">Username must be at least 3 characters</p>
          }
        </div>

        <!-- First Name -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">
            First Name <span class="text-red-500">*</span>
          </label>
          <input
            type="text"
            formControlName="firstName"
            class="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all"
            [class.border-red-500]="hasError('firstName', 'required') || hasError('firstName', 'minlength')"
            [class.border-gray-300]="!hasError('firstName', 'required') && !hasError('firstName', 'minlength')"
            placeholder="e.g., Ahmed" />
          @if (hasError('firstName', 'required')) {
            <p class="mt-1 text-sm text-red-500">First name is required</p>
          }
          @if (hasError('firstName', 'minlength')) {
            <p class="mt-1 text-sm text-red-500">First name must be at least 2 characters</p>
          }
        </div>

        <!-- Email (Required) -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">
            Email Address <span class="text-red-500">*</span>
          </label>
          <p class="text-xs text-gray-500 mb-2">üìß This email will be used for student login</p>
          <input
            type="email"
            formControlName="email"
            class="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all"
            [class.border-red-500]="hasError('email', 'required') || hasError('email', 'email')"
            [class.border-gray-300]="!hasError('email', 'required') && !hasError('email', 'email')"
            placeholder="student@example.com" />
          @if (hasError('email', 'required')) {
            <p class="mt-1 text-sm text-red-500">Email is required for login</p>
          }
          @if (hasError('email', 'email')) {
            <p class="mt-1 text-sm text-red-500">Invalid email format</p>
          }
        </div>

        <!-- Password & Confirm Password Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <!-- Password -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">
              Password <span class="text-red-500">*</span>
            </label>
            <input
              type="password"
              formControlName="password"
              class="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all"
              [class.border-red-500]="hasError('password', 'required') || hasError('password', 'minlength')"
              [class.border-gray-300]="!hasError('password', 'required') && !hasError('password', 'minlength')"
              placeholder="Min 8 characters" />
            @if (hasError('password', 'required')) {
              <p class="mt-1 text-sm text-red-500">Password is required</p>
            }
            @if (hasError('password', 'minlength')) {
              <p class="mt-1 text-sm text-red-500">Password must be at least 8 characters</p>
            }
          </div>

          <!-- Confirm Password -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">
              Confirm Password <span class="text-red-500">*</span>
            </label>
            <input
              type="password"
              formControlName="confirmPassword"
              class="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all"
              [class.border-red-500]="addStudentForm.hasError('passwordMismatch') && addStudentForm.get('confirmPassword')?.touched"
              [class.border-gray-300]="!addStudentForm.hasError('passwordMismatch') || !addStudentForm.get('confirmPassword')?.touched"
              placeholder="Repeat password" />
            @if (addStudentForm.hasError('passwordMismatch') && addStudentForm.get('confirmPassword')?.touched) {
              <p class="mt-1 text-sm text-red-500">Passwords do not match</p>
            }
          </div>
        </div>

        <!-- Age & Academic Year Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <!-- Age -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">
              Age <span class="text-red-500">*</span>
            </label>
            <input
              type="number"
              formControlName="age"
              class="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all"
              [class.border-red-500]="hasError('age', 'required') || hasError('age', 'min') || hasError('age', 'max')"
              [class.border-gray-300]="!hasError('age', 'required') && !hasError('age', 'min') && !hasError('age', 'max')"
              placeholder="e.g., 12"
              min="5"
              max="18" />
            @if (hasError('age', 'required')) {
              <p class="mt-1 text-sm text-red-500">Age is required</p>
            }
            @if (hasError('age', 'min') || hasError('age', 'max')) {
              <p class="mt-1 text-sm text-red-500">Age must be between 5 and 18</p>
            }
          </div>

          <!-- Academic Year -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">
              Academic Year <span class="text-red-500">*</span>
            </label>
            @if (yearsLoading()) {
              <div class="w-full px-4 py-3 border border-gray-300 rounded-lg bg-gray-50 text-gray-500">
                Loading years from database...
              </div>
            } @else {
              <select
                formControlName="yearId"
                class="w-full px-4 py-3 border rounded-lg bg-white focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all"
                [class.border-red-500]="hasError('yearId', 'required')"
                [class.border-gray-300]="!hasError('yearId', 'required')">
                <option value="" disabled selected>Select year</option>
                @for (year of academicYears; track year.id) {
                  <option [value]="year.id">{{ year.name }} - {{ year.nameAr }}</option>
                }
              </select>
              @if (hasError('yearId', 'required')) {
                <p class="mt-1 text-sm text-red-500">Academic year is required</p>
              }
            }
          </div>
        </div>

        <!-- Phone Number (Optional) -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">
            Phone Number <span class="text-gray-400 text-xs">(Optional)</span>
          </label>
          <input
            type="tel"
            formControlName="phoneNumber"
            class="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all"
            [class.border-red-500]="hasError('phoneNumber', 'pattern')"
            [class.border-gray-300]="!hasError('phoneNumber', 'pattern')"
            placeholder="+1234567890" />
          @if (hasError('phoneNumber', 'pattern')) {
            <p class="mt-1 text-sm text-red-500">Invalid phone number format</p>
          }
        </div>

        <!-- Info Box -->
        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
          <div class="flex items-start gap-3">
            <span class="text-2xl">‚ÑπÔ∏è</span>
            <div class="flex-1">
              <h4 class="text-sm font-semibold text-blue-900 mb-1">Parent Linking</h4>
              <p class="text-sm text-blue-800">
                This student will be automatically linked to your parent account.
                You'll be able to monitor their progress from your dashboard.
              </p>
            </div>
          </div>
        </div>

        <!-- Error Message -->
        @if (error()) {
          <div class="bg-red-50 border border-red-200 rounded-lg p-4">
            <div class="flex items-center gap-3">
              <span class="text-2xl">‚ùå</span>
              <p class="text-sm text-red-800">{{ error() }}</p>
            </div>
          </div>
        }

        <!-- Success Message -->
        @if (success()) {
          <div class="bg-green-50 border border-green-200 rounded-lg p-4">
            <div class="flex items-center gap-3">
              <span class="text-2xl">‚úÖ</span>
              <p class="text-sm text-green-800">Student registered successfully!</p>
            </div>
          </div>
        }

        <!-- Action Buttons -->
        <div class="flex flex-col sm:flex-row gap-4 pt-4">
          <button
            type="button"
            (click)="cancel()"
            class="flex-1 px-6 py-3 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors font-medium">
            Cancel
          </button>
          <button
            type="submit"
            [disabled]="loading() || addStudentForm.invalid"
            class="flex-1 px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors font-medium disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2">
            @if (loading()) {
              <div class="animate-spin rounded-full h-5 w-5 border-b-2 border-white"></div>
              <span>Adding Student...</span>
            } @else {
              <span>‚ûï</span>
              <span>Add Student</span>
            }
          </button>
        </div>

        <!-- Form Helper Text -->
        <p class="text-xs text-gray-500 text-center">
          Fields marked with <span class="text-red-500">*</span> are required
        </p>
      </form>
    </div>

    <!-- Additional Info -->
    <div class="mt-6 bg-gray-100 rounded-lg p-6">
      <h3 class="text-lg font-semibold text-gray-900 mb-3">What happens next?</h3>
      <ul class="space-y-2 text-sm text-gray-700">
        <li class="flex items-start gap-2">
          <span class="text-green-600 mt-0.5">‚úì</span>
          <span>Student account will be created and linked to your parent account</span>
        </li>
        <li class="flex items-start gap-2">
          <span class="text-green-600 mt-0.5">‚úì</span>
          <span>You can view their progress from your parent dashboard</span>
        </li>
        <li class="flex items-start gap-2">
          <span class="text-green-600 mt-0.5">‚úì</span>
          <span>Student can login with their username and password</span>
        </li>
        <li class="flex items-start gap-2">
          <span class="text-green-600 mt-0.5">‚úì</span>
          <span>You'll need to purchase a subscription for them to access content</span>
        </li>
      </ul>
    </div>

  </div>
</div>
