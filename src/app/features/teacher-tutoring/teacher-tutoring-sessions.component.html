<main class="px-2 sm:px-4 lg:px-8 py-4 min-h-screen bg-gray-50">

  <!-- Page Header -->
  <div class="mb-6">
    <div class="bg-gradient-to-r from-teal-600 to-cyan-600 rounded-2xl shadow-xl p-6 text-white">
      <div class="flex flex-col lg:flex-row items-start lg:items-center justify-between gap-4">
        <div class="flex items-center gap-4">
          <div class="p-3 bg-white/20 backdrop-blur-lg rounded-xl">
            <i class="fas fa-chalkboard-teacher text-3xl"></i>
          </div>
          <div>
            <h1 class="text-3xl font-bold">Tutoring Management</h1>
            <p class="text-teal-100 text-sm mt-1">Manage your availability, sessions, and exceptions</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Tabs -->
  <div class="mb-6">
    <div class="bg-white rounded-xl shadow-md p-2 inline-flex gap-2">
      <button 
        (click)="switchTab('sessions')"
        [class]="activeTab() === 'sessions' 
          ? 'px-6 py-3 rounded-lg font-semibold bg-teal-600 text-white shadow-md transition-all' 
          : 'px-6 py-3 rounded-lg font-semibold text-gray-600 hover:bg-gray-100 transition-all'">
        <i class="fas fa-calendar-alt mr-2"></i>My Sessions
      </button>
      <button 
        (click)="switchTab('availability')"
        [class]="activeTab() === 'availability' 
          ? 'px-6 py-3 rounded-lg font-semibold bg-teal-600 text-white shadow-md transition-all' 
          : 'px-6 py-3 rounded-lg font-semibold text-gray-600 hover:bg-gray-100 transition-all'">
        <i class="fas fa-clock mr-2"></i>Availability
      </button>
    </div>
  </div>

  <!-- Loading State -->
  @if (loading()) {
    <div class="flex items-center justify-center py-20">
      <div class="text-center">
        <div class="animate-spin rounded-full h-16 w-16 border-b-4 border-teal-600 mx-auto mb-4"></div>
        <p class="text-gray-600 text-lg">Loading...</p>
      </div>
    </div>
  }

  <!-- Sessions Tab -->
  @if (!loading() && activeTab() === 'sessions') {
    <div class="space-y-6">
      
      <!-- Stats Cards -->
      <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
        <div class="bg-white rounded-xl shadow-md p-5 border-l-4 border-blue-500">
          <div class="flex items-center gap-3">
            <div class="p-3 bg-blue-100 rounded-lg">
              <i class="fas fa-calendar-check text-blue-600 text-xl"></i>
            </div>
            <div>
              <p class="text-2xl font-bold text-gray-900">{{ getSessionStats().scheduled }}</p>
              <p class="text-sm text-gray-500">Scheduled</p>
            </div>
          </div>
        </div>
        <div class="bg-white rounded-xl shadow-md p-5 border-l-4 border-orange-500">
          <div class="flex items-center gap-3">
            <div class="p-3 bg-orange-100 rounded-lg">
              <i class="fas fa-play-circle text-orange-600 text-xl"></i>
            </div>
            <div>
              <p class="text-2xl font-bold text-gray-900">{{ getSessionStats().inProgress }}</p>
              <p class="text-sm text-gray-500">In Progress</p>
            </div>
          </div>
        </div>
        <div class="bg-white rounded-xl shadow-md p-5 border-l-4 border-green-500">
          <div class="flex items-center gap-3">
            <div class="p-3 bg-green-100 rounded-lg">
              <i class="fas fa-check-circle text-green-600 text-xl"></i>
            </div>
            <div>
              <p class="text-2xl font-bold text-gray-900">{{ getSessionStats().completed }}</p>
              <p class="text-sm text-gray-500">Completed</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Calendar Controls -->
      <div class="bg-white rounded-xl shadow-md p-4">
        <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4">
          <!-- View Mode Selector -->
          <div class="flex items-center gap-2">
            <span class="text-sm font-medium text-gray-600">View:</span>
            <div class="flex gap-1 bg-gray-100 rounded-lg p-1">
              <button 
                (click)="setViewMode('today')"
                [class]="viewMode() === 'today' ? 'px-4 py-2 rounded-md bg-white shadow text-teal-600 font-semibold text-sm' : 'px-4 py-2 rounded-md text-gray-600 text-sm hover:bg-gray-200'">
                Today
              </button>
              <button 
                (click)="setViewMode('day')"
                [class]="viewMode() === 'day' ? 'px-4 py-2 rounded-md bg-white shadow text-teal-600 font-semibold text-sm' : 'px-4 py-2 rounded-md text-gray-600 text-sm hover:bg-gray-200'">
                Day
              </button>
              <button 
                (click)="setViewMode('week')"
                [class]="viewMode() === 'week' ? 'px-4 py-2 rounded-md bg-white shadow text-teal-600 font-semibold text-sm' : 'px-4 py-2 rounded-md text-gray-600 text-sm hover:bg-gray-200'">
                Week
              </button>
            </div>
          </div>

          <!-- Date Navigation -->
          <div class="flex items-center gap-3">
            <button (click)="changeDate('prev')" class="p-2 rounded-lg hover:bg-gray-100">
              <i class="fas fa-chevron-left text-gray-600"></i>
            </button>
            
            @if (viewMode() !== 'week') {
              <input 
                type="date" 
                [value]="formatDateForInput(selectedDate())"
                (change)="setSelectedDate($event)"
                class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent">
            } @else {
              <span class="px-4 py-2 font-medium text-gray-700">
                {{ formatDate(getWeekDates()[0]) }} - {{ formatDate(getWeekDates()[6]) }}
              </span>
            }
            
            <button (click)="changeDate('next')" class="p-2 rounded-lg hover:bg-gray-100">
              <i class="fas fa-chevron-right text-gray-600"></i>
            </button>

            @if (!isToday(selectedDate())) {
              <button (click)="goToToday()" class="px-4 py-2 text-sm font-medium text-teal-600 hover:bg-teal-50 rounded-lg">
                Go to Today
              </button>
            }

            <button (click)="refreshSessions()" class="px-4 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700 flex items-center gap-2">
              <i class="fas fa-sync-alt"></i>
              <span class="hidden sm:inline">Refresh</span>
            </button>
          </div>
        </div>
      </div>

      <!-- Calendar View -->
      <div class="bg-white rounded-xl shadow-md p-6">
        <!-- Week View -->
        @if (viewMode() === 'week') {
          <div class="grid grid-cols-7 gap-4">
            @for (date of getWeekDates(); track date) {
              <div class="min-h-[200px]">
                <div [class]="isToday(date) ? 'text-center p-2 bg-teal-600 text-white rounded-t-lg' : 'text-center p-2 bg-gray-100 rounded-t-lg'">
                  <p class="font-semibold">{{ weekDays[date.getDay()] }}</p>
                  <p class="text-sm">{{ date.getDate() }}</p>
                </div>
                <div class="border border-t-0 border-gray-200 rounded-b-lg p-2 min-h-[160px] bg-gray-50">
                  @for (session of getSessionsForDate(date); track session.id) {
                    <div 
                      class="mb-2 p-2 rounded-lg cursor-pointer transition-all hover:shadow-md"
                      [class]="session.status === 'Scheduled' ? 'bg-blue-50 border-l-4 border-blue-500' : 
                               session.status === 'InProgress' ? 'bg-orange-50 border-l-4 border-orange-500' : 
                               session.status === 'Completed' ? 'bg-green-50 border-l-4 border-green-500' : 
                               'bg-gray-100 border-l-4 border-gray-400'">
                      <div class="flex items-center justify-between">
                        <span class="text-xs font-semibold text-gray-700">{{ session.startTime || formatTime(session.dateTime.toString()) }}</span>
                        @if (session.meetingLink) {
                          <button 
                            (click)="openMeetingLink(session); $event.stopPropagation()"
                            class="p-1 text-teal-600 hover:bg-teal-100 rounded"
                            title="Join Meeting">
                            <i class="fas fa-video"></i>
                          </button>
                        }
                      </div>
                      <p class="text-xs text-gray-600 truncate">{{ session.studentName }}</p>
                      <p class="text-xs text-gray-500 truncate">{{ session.subjectName }}</p>
                    </div>
                  }
                  @if (getSessionsForDate(date).length === 0) {
                    <p class="text-xs text-gray-400 text-center py-4">No sessions</p>
                  }
                </div>
              </div>
            }
          </div>
        }

        <!-- Today/Day View -->
        @if (viewMode() !== 'week') {
          <div>
            <h3 class="text-lg font-semibold text-gray-800 mb-4">
              @if (viewMode() === 'today') {
                Today's Sessions
              } @else {
                Sessions for {{ formatDate(selectedDate()) }}
              }
            </h3>

            @if (filteredSessions().length === 0) {
              <div class="text-center py-12 bg-gray-50 rounded-xl">
                <i class="fas fa-calendar-times text-4xl text-gray-300 mb-4"></i>
                <p class="text-gray-500">No sessions for this date</p>
              </div>
            }

            <div class="space-y-3">
              @for (session of filteredSessions(); track session.id) {
                <div 
                  class="flex items-center justify-between p-4 rounded-xl transition-all hover:shadow-md"
                  [class]="session.status === 'Scheduled' ? 'bg-blue-50 border border-blue-200' : 
                           session.status === 'InProgress' ? 'bg-orange-50 border border-orange-200' : 
                           session.status === 'Completed' ? 'bg-green-50 border border-green-200' : 
                           'bg-gray-50 border border-gray-200'">
                  <div class="flex items-center gap-4">
                    <div class="text-center">
                      <p class="text-lg font-bold text-gray-800">{{ session.startTime || formatTime(session.dateTime.toString()) }}</p>
                      <p class="text-xs text-gray-500">{{ session.duration }} min</p>
                    </div>
                    <div class="h-12 w-px bg-gray-300"></div>
                    <div>
                      <p class="font-semibold text-gray-800">{{ session.studentName }}</p>
                      <p class="text-sm text-gray-600">{{ session.subjectName }}</p>
                    </div>
                  </div>
                  
                  <div class="flex items-center gap-3">
                    @if (session.meetingLink) {
                      <button 
                        (click)="openMeetingLink(session)"
                        class="p-2 text-teal-600 hover:bg-teal-100 rounded-lg transition-all"
                        title="Join Meeting">
                        <i class="fas fa-video text-lg"></i>
                      </button>
                    }
                    
                    <span 
                      class="px-3 py-1 rounded-full text-xs font-semibold"
                      [class]="session.status === 'Scheduled' ? 'bg-blue-100 text-blue-700' : 
                               session.status === 'InProgress' ? 'bg-orange-100 text-orange-700' : 
                               session.status === 'Completed' ? 'bg-green-100 text-green-700' : 
                               'bg-gray-100 text-gray-700'">
                      {{ session.status }}
                    </span>

                    <div class="flex gap-2">
                      @if (session.status === 'Scheduled') {
                        <button (click)="startSession(session)" class="px-3 py-1 bg-teal-600 text-white text-sm rounded-lg hover:bg-teal-700">
                          Start
                        </button>
                        <button (click)="cancelSession(session)" class="px-3 py-1 bg-red-100 text-red-600 text-sm rounded-lg hover:bg-red-200">
                          Cancel
                        </button>
                      }
                      @if (session.status === 'InProgress') {
                        <button (click)="completeSession(session)" class="px-3 py-1 bg-green-600 text-white text-sm rounded-lg hover:bg-green-700">
                          Complete
                        </button>
                      }
                    </div>
                  </div>
                </div>
              }
            </div>
          </div>
        }
      </div>
    </div>
  }

  <!-- Availability Tab -->
  @if (!loading() && activeTab() === 'availability') {
    <div class="space-y-6">

      <!-- Settings Card -->
      <div class="bg-white rounded-xl shadow-md p-6">
        <div class="flex items-center justify-between mb-6">
          <div>
            <h2 class="text-xl font-bold text-gray-900">Session Settings</h2>
            <p class="text-sm text-gray-500">Configure your session preferences</p>
          </div>
          <button
            (click)="toggleSettingsForm()"
            class="px-5 py-2 bg-indigo-600 text-white font-medium rounded-lg hover:bg-indigo-700 transition-all">
            {{ showSettingsForm() ? 'Cancel' : 'Edit Settings' }}
          </button>
        </div>

        <!-- Current Settings Display -->
        @if (!showSettingsForm() && settings()) {
          <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 gap-4">
            <div class="bg-gradient-to-br from-blue-50 to-indigo-50 p-4 rounded-xl border border-blue-200">
              <p class="text-sm text-gray-600 mb-1">Duration</p>
              <p class="text-xl font-bold text-gray-900">{{ settings()!.sessionDurationMinutes }} min</p>
            </div>
            <div class="bg-gradient-to-br from-purple-50 to-pink-50 p-4 rounded-xl border border-purple-200">
              <p class="text-sm text-gray-600 mb-1">Buffer</p>
              <p class="text-xl font-bold text-gray-900">{{ settings()!.bufferTimeMinutes }} min</p>
            </div>
            <div class="bg-gradient-to-br from-green-50 to-emerald-50 p-4 rounded-xl border border-green-200">
              <p class="text-sm text-gray-600 mb-1">Price</p>
              <p class="text-xl font-bold text-gray-900">${{ settings()!.pricePerSession }}</p>
            </div>
            <div class="bg-gradient-to-br from-orange-50 to-amber-50 p-4 rounded-xl border border-orange-200">
              <p class="text-sm text-gray-600 mb-1">Max/Day</p>
              <p class="text-xl font-bold text-gray-900">{{ settings()!.maxSessionsPerDay || '-' }}</p>
            </div>
            <div class="bg-gradient-to-br from-cyan-50 to-sky-50 p-4 rounded-xl border border-cyan-200">
              <p class="text-sm text-gray-600 mb-1">Status</p>
              <span [class]="settings()!.isAcceptingBookings ? 'px-3 py-1 rounded-full text-sm font-semibold bg-green-100 text-green-800' : 'px-3 py-1 rounded-full text-sm font-semibold bg-red-100 text-red-800'">
                {{ settings()!.isAcceptingBookings ? 'Open' : 'Closed' }}
              </span>
            </div>
          </div>
        }

        <!-- Settings Form -->
        @if (showSettingsForm()) {
          <form [formGroup]="settingsForm" (ngSubmit)="saveSettings()" class="space-y-4">
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Duration (min)</label>
                <input type="number" formControlName="sessionDurationMinutes" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500" min="15" max="180">
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Buffer (min)</label>
                <input type="number" formControlName="bufferTimeMinutes" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500" min="0" max="60">
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Price ($)</label>
                <input type="number" formControlName="pricePerSession" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500" min="1">
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Max Sessions/Day</label>
                <input type="number" formControlName="maxSessionsPerDay" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500" min="1" max="20">
              </div>
            </div>
            <div class="flex items-center gap-2">
              <input type="checkbox" id="isAcceptingBookings" formControlName="isAcceptingBookings" class="w-5 h-5 text-indigo-600 rounded">
              <label for="isAcceptingBookings" class="text-sm text-gray-700">Accept New Bookings</label>
            </div>
            <div class="flex gap-3">
              <button type="submit" [disabled]="savingSettings() || settingsForm.invalid" class="px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:bg-gray-400">
                {{ savingSettings() ? 'Saving...' : 'Save Changes' }}
              </button>
              <button type="button" (click)="toggleSettingsForm()" class="px-6 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300">
                Cancel
              </button>
            </div>
          </form>
        }
      </div>

      <!-- Time Slots Card -->
      <div class="bg-white rounded-xl shadow-md p-6">
        <div class="flex items-center justify-between mb-6">
          <div>
            <h2 class="text-xl font-bold text-gray-900">Available Time Slots</h2>
            <p class="text-sm text-gray-500">Manage your weekly availability</p>
          </div>
          <button
            (click)="toggleAvailabilityForm()"
            class="px-5 py-2 bg-green-600 text-white font-medium rounded-lg hover:bg-green-700 transition-all flex items-center gap-2">
            @if (!showAvailabilityForm()) {
              <i class="fas fa-plus"></i>
            }
            {{ showAvailabilityForm() ? 'Cancel' : 'Add Time Slot' }}
          </button>
        </div>

        <!-- Add Availability Form -->
        @if (showAvailabilityForm()) {
          <div class="bg-gradient-to-br from-green-50 to-emerald-50 border-2 border-green-200 p-6 rounded-xl mb-6">
            <div class="flex items-center justify-between mb-4">
              <h3 class="text-lg font-semibold text-gray-900">Add New Time Slot</h3>
              <button 
                (click)="toggleSlotGenerator()"
                class="text-sm text-teal-600 hover:underline flex items-center gap-1">
                <i class="fas fa-magic"></i>
                {{ showSlotGenerator() ? 'Simple Mode' : 'Advanced: Slot Generator' }}
              </button>
            </div>

            <!-- Simple Mode -->
            @if (!showSlotGenerator()) {
              <form [formGroup]="availabilityForm" (ngSubmit)="addAvailability()">
                <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-4">
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Day</label>
                    <select formControlName="dayOfWeek" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                      <option value="">Select Day</option>
                      @for (day of daysOfWeek; track day.value) {
                        <option [value]="day.value">{{ day.label }}</option>
                      }
                    </select>
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Start Time</label>
                    <input type="time" formControlName="startTime" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">End Time</label>
                    <input type="time" formControlName="endTime" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                  </div>
                </div>
                <div class="flex gap-3">
                  <button type="submit" [disabled]="addingAvailability() || availabilityForm.invalid" class="px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:bg-gray-400">
                    {{ addingAvailability() ? 'Adding...' : 'Add Time Slot' }}
                  </button>
                  <button type="button" (click)="toggleAvailabilityForm()" class="px-6 py-2 bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50">
                    Cancel
                  </button>
                </div>
              </form>
            }

            <!-- Slot Generator Mode -->
            @if (showSlotGenerator()) {
              <form [formGroup]="slotGeneratorForm" (ngSubmit)="generateSlots()">
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 mb-4">
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Day</label>
                    <select formControlName="dayOfWeek" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500">
                      <option value="">Select Day</option>
                      @for (day of daysOfWeek; track day.value) {
                        <option [value]="day.value">{{ day.label }}</option>
                      }
                    </select>
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Start Time</label>
                    <input type="time" formControlName="startTime" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500">
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">End Time</label>
                    <input type="time" formControlName="endTime" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500">
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Session Duration (min)</label>
                    <input type="number" formControlName="sessionDuration" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500" min="15" max="180">
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Break Between (min)</label>
                    <input type="number" formControlName="breakBetweenSessions" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500" min="0" max="60">
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Session Type</label>
                    <select formControlName="defaultSessionType" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500">
                      <option value="OneToOne">One-to-One</option>
                      <option value="Group">Group</option>
                    </select>
                  </div>
                </div>
                <div class="flex gap-3">
                  <button type="submit" [disabled]="addingAvailability() || slotGeneratorForm.invalid" class="px-6 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700 disabled:bg-gray-400 flex items-center gap-2">
                    <i class="fas fa-magic"></i>
                    {{ addingAvailability() ? 'Generating...' : 'Generate Slots' }}
                  </button>
                  <button type="button" (click)="toggleAvailabilityForm()" class="px-6 py-2 bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50">
                    Cancel
                  </button>
                </div>
              </form>
            }
          </div>
        }

        <!-- Availabilities List -->
        @if (availabilities().length > 0) {
          <div class="space-y-4">
            @for (day of getSortedDays(); track day) {
              <div class="bg-gray-50 border border-gray-200 rounded-xl p-4">
                <div class="flex items-center gap-3 mb-3">
                  <i class="fas fa-calendar-day text-indigo-600"></i>
                  <h3 class="text-lg font-bold text-gray-900">{{ day }}</h3>
                  <span class="text-sm text-gray-500 ml-auto">{{ getAvailabilitiesByDay()[day].length }} slot(s)</span>
                </div>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3">
                  @for (availability of getAvailabilitiesByDay()[day]; track availability.id) {
                    <div class="flex items-center justify-between bg-white border border-gray-200 p-3 rounded-lg">
                      <div class="flex items-center gap-2">
                        <i class="fas fa-clock text-indigo-500"></i>
                        <span class="font-medium text-gray-800">{{ formatTime(availability.startTime) }} - {{ formatTime(availability.endTime) }}</span>
                      </div>
                      <button
                        (click)="deleteAvailability(availability)"
                        class="p-2 text-red-500 hover:bg-red-50 rounded-lg transition-all">
                        <i class="fas fa-trash-alt"></i>
                      </button>
                    </div>
                  }
                </div>
              </div>
            }
          </div>
        }

        <!-- Empty State -->
        @if (availabilities().length === 0) {
          <div class="text-center py-12 bg-gray-50 rounded-xl border-2 border-dashed border-gray-300">
            <i class="fas fa-calendar-plus text-4xl text-gray-300 mb-4"></i>
            <h3 class="text-lg font-semibold text-gray-700 mb-2">No time slots yet</h3>
            <p class="text-gray-500 mb-4">Add your available times for private sessions</p>
            <button (click)="toggleAvailabilityForm()" class="px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700">
              <i class="fas fa-plus mr-2"></i>Add Your First Time Slot
            </button>
          </div>
        }
      </div>

      <!-- Exception Days Card -->
      <div class="bg-white rounded-xl shadow-md p-6">
        <div class="flex items-center justify-between mb-6">
          <div>
            <h2 class="text-xl font-bold text-gray-900">Exception Days</h2>
            <p class="text-sm text-gray-500">Mark days when you're unavailable (holidays, time off)</p>
          </div>
          <button
            (click)="toggleExceptionForm()"
            class="px-5 py-2 bg-amber-600 text-white font-medium rounded-lg hover:bg-amber-700 transition-all flex items-center gap-2">
            @if (!showExceptionForm()) {
              <i class="fas fa-plus"></i>
            }
            {{ showExceptionForm() ? 'Cancel' : 'Add Exception' }}
          </button>
        </div>

        <!-- Add Exception Form -->
        @if (showExceptionForm()) {
          <form [formGroup]="exceptionForm" (ngSubmit)="addException()" class="bg-gradient-to-br from-amber-50 to-orange-50 border-2 border-amber-200 p-6 rounded-xl mb-6">
            <h3 class="text-lg font-semibold text-gray-900 mb-4">Add Exception Day</h3>
            <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Start Date</label>
                <input type="date" formControlName="startDate" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-500">
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">End Date (Optional)</label>
                <input type="date" formControlName="endDate" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-500">
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Reason (Optional)</label>
                <input type="text" formControlName="reason" placeholder="e.g., Holiday" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-500">
              </div>
            </div>
            <div class="flex gap-3">
              <button type="submit" [disabled]="addingException() || exceptionForm.invalid" class="px-6 py-2 bg-amber-600 text-white rounded-lg hover:bg-amber-700 disabled:bg-gray-400">
                {{ addingException() ? 'Adding...' : 'Add Exception' }}
              </button>
              <button type="button" (click)="toggleExceptionForm()" class="px-6 py-2 bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50">
                Cancel
              </button>
            </div>
          </form>
        }

        <!-- Exceptions List -->
        @if (exceptions().length > 0) {
          <div class="space-y-3">
            @for (exception of exceptions(); track exception.id) {
              <div class="flex items-center justify-between bg-amber-50 border border-amber-200 p-4 rounded-lg">
                <div class="flex items-center gap-4">
                  <i class="fas fa-calendar-times text-amber-600 text-xl"></i>
                  <div>
                    <p class="font-semibold text-gray-800">
                      @if (exception.startDate === exception.endDate) {
                        {{ exception.startDate }}
                      } @else {
                        {{ exception.startDate }} â†’ {{ exception.endDate }}
                      }
                    </p>
                    @if (exception.reason) {
                      <p class="text-sm text-gray-600">{{ exception.reason }}</p>
                    }
                  </div>
                </div>
                <button
                  (click)="deleteException(exception)"
                  class="p-2 text-red-500 hover:bg-red-50 rounded-lg transition-all">
                  <i class="fas fa-trash-alt"></i>
                </button>
              </div>
            }
          </div>
        }

        <!-- Empty State -->
        @if (exceptions().length === 0 && !showExceptionForm()) {
          <div class="text-center py-8 bg-gray-50 rounded-xl">
            <i class="fas fa-umbrella-beach text-3xl text-gray-300 mb-3"></i>
            <p class="text-gray-500">No exception days added</p>
          </div>
        }
      </div>

    </div>
  }

</main>
