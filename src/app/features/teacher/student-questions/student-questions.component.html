<!-- Main Content -->
<main class="px-4 sm:px-6 lg:px-8 py-8">
    
    <!-- Page Title -->
    <div class="mb-8">
      <h1 class="text-4xl font-bold text-gray-900 flex items-center gap-3 mb-2">
        <i class="fas fa-comments text-green-600"></i>
        Student Questions
      </h1>
      <p class="text-gray-600">View and answer questions from your students</p>
    </div>

    <!-- Stats Cards -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
      <div class="bg-white rounded-lg shadow-sm p-6 border-l-4 border-blue-500">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-gray-600 text-sm font-medium mb-1">Total Questions</p>
            <p class="text-3xl font-bold text-gray-900">{{ totalCount() }}</p>
          </div>
          <i class="fas fa-question-circle text-4xl text-blue-200"></i>
        </div>
      </div>

      <div class="bg-white rounded-lg shadow-sm p-6 border-l-4 border-yellow-500">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-gray-600 text-sm font-medium mb-1">Pending</p>
            <p class="text-3xl font-bold text-gray-900">{{ pendingCount() }}</p>
          </div>
          <i class="fas fa-clock text-4xl text-yellow-200"></i>
        </div>
      </div>

      <div class="bg-white rounded-lg shadow-sm p-6 border-l-4 border-green-500">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-gray-600 text-sm font-medium mb-1">Answered</p>
            <p class="text-3xl font-bold text-gray-900">{{ answeredCount() }}</p>
          </div>
          <i class="fas fa-check-circle text-4xl text-green-200"></i>
        </div>
      </div>
    </div>

    <!-- Filters -->
    <div class="bg-white rounded-lg shadow-sm p-6 mb-8">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <!-- Search -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Search Questions</label>
          <input
            type="text"
            placeholder="Search by title or content..."
            [value]="searchTerm()"
            (change)="searchTerm.set($any($event.target).value)"
            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
          />
        </div>

        <!-- Status Filter -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Filter by Status</label>
          <select
            [value]="filterStatus()"
            (change)="filterStatus.set($any($event.target).value)"
            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
          >
            <option value="all">All Questions</option>
            <option value="pending">Pending</option>
            <option value="answered">Answered</option>
          </select>
        </div>
      </div>
    </div>

    <!-- Loading State -->
    @if (loading()) {
      <div class="bg-white rounded-lg shadow-sm p-12 text-center">
        <i class="fas fa-spinner fa-spin text-4xl text-blue-600 mb-4"></i>
        <p class="text-gray-600">Loading questions...</p>
      </div>
    } @else if (error()) {
      <div class="bg-red-50 border border-red-200 rounded-lg p-6 mb-8">
        <div class="flex items-center gap-3">
          <i class="fas fa-exclamation-circle text-red-600 text-2xl"></i>
          <div>
            <p class="font-medium text-red-900">Error</p>
            <p class="text-red-700 text-sm">{{ error() }}</p>
          </div>
          <button (click)="error.set(null)" class="ml-auto text-red-600 hover:text-red-800">
            <i class="fas fa-times text-xl"></i>
          </button>
        </div>
      </div>
      <button (click)="loadQuestions()" class="w-full bg-red-600 hover:bg-red-700 text-white font-medium py-2 rounded-lg">
        <i class="fas fa-redo me-2"></i>Try Again
      </button>
    } @else if (filteredQuestions().length === 0) {
      <div class="bg-white rounded-lg shadow-sm p-12 text-center">
        <i class="fas fa-inbox text-5xl text-gray-300 mb-4"></i>
        <p class="text-gray-600 text-lg">No questions found</p>
        <p class="text-gray-500 text-sm mt-2">
          @if (searchTerm()) {
            Try adjusting your search criteria
          } @else {
            There are no questions matching the selected filter
          }
        </p>
      </div>
    } @else {
      <!-- Questions List -->
      <div class="space-y-4">
        @for (question of filteredQuestions(); track question.id) {
          <div
            class="bg-white rounded-lg shadow-sm hover:shadow-md transition-shadow border border-gray-200"
            [class.border-blue-200]="selectedQuestionId() === question.id"
            [class.bg-blue-50]="selectedQuestionId() === question.id"
          >
            <!-- Question Header -->
            <div class="p-6 border-b border-gray-200">
              <div class="flex items-start justify-between gap-4">
                <div class="flex-grow">
                  <div class="flex items-center gap-3 mb-2">
                    <h3 class="text-lg font-semibold text-gray-900">{{ question.title || 'Untitled Question' }}</h3>
                    <span
                      class="inline-block px-3 py-1 rounded-full text-xs font-medium"
                      [ngClass]="getStatusColor(question.isAnswered)"
                    >
                      {{ getStatusText(question.isAnswered) }}
                    </span>
                  </div>
                  <p class="text-gray-600 text-sm mb-3">{{ question.questionText }}</p>
                  <div class="flex items-center gap-4 text-sm text-gray-500">
                    @if (question.studentName) {
                      <span><i class="fas fa-user me-2"></i>{{ question.studentName }}</span>
                    }
                    @if (question.subjectName) {
                      <span><i class="fas fa-book me-2"></i>{{ question.subjectName }}</span>
                    }
                    <span><i class="fas fa-calendar me-2"></i>{{ formatDate(question.createdAt) }}</span>
                  </div>
                </div>
                <button
                  (click)="selectQuestion(question.id)"
                  class="px-4 py-2 rounded-lg transition-colors"
                  [ngClass]="selectedQuestionId() === question.id
                    ? 'bg-blue-600 text-white'
                    : 'bg-gray-100 text-gray-700 hover:bg-gray-200'"
                >
                  @if (selectedQuestionId() === question.id) {
                    <i class="fas fa-chevron-up me-2"></i>Hide
                  } @else {
                    <i class="fas fa-chevron-down me-2"></i>Show
                  }
                </button>
              </div>
            </div>

            <!-- Answer Section (Expanded) -->
            @if (selectedQuestionId() === question.id) {
              <div class="p-6 bg-gradient-to-r from-blue-50 to-indigo-50">
                @if (question.isAnswered) {
                  <!-- Show Existing Answer -->
                  <div class="bg-white border-l-4 border-green-500 rounded-lg p-4 mb-4">
                    <p class="text-sm font-medium text-gray-700 mb-2">Your Answer:</p>
                    <p class="text-gray-800">{{ question.answerText }}</p>
                    @if (question.answeredAt) {
                      <p class="text-xs text-gray-500 mt-3">
                        <i class="fas fa-check me-1"></i>Answered on {{ formatDate(question.answeredAt) }}
                      </p>
                    }
                  </div>
                } @else {
                  <!-- Answer Form -->
                  <form [formGroup]="answerForm" (ngSubmit)="submitAnswer(question.id)">
                    <div class="mb-4">
                      <label class="block text-sm font-medium text-gray-700 mb-2">
                        Your Answer <span class="text-red-500">*</span>
                      </label>
                      <textarea
                        formControlName="answerText"
                        placeholder="Write your detailed answer here (minimum 10 characters)..."
                        rows="5"
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"
                        [class.border-red-500]="answerForm.get('answerText')?.invalid && answerForm.get('answerText')?.touched"
                      ></textarea>
                      @if (answerForm.get('answerText')?.invalid && answerForm.get('answerText')?.touched) {
                        <p class="text-red-500 text-xs mt-1">
                          <i class="fas fa-exclamation-circle me-1"></i>
                          @if (answerForm.get('answerText')?.errors?.['required']) {
                            Answer is required
                          } @else if (answerForm.get('answerText')?.errors?.['minlength']) {
                            Answer must be at least 10 characters
                          }
                        </p>
                      }
                    </div>

                    <div class="flex gap-3">
                      <button
                        type="submit"
                        [disabled]="submitting() || !answerForm.valid"
                        class="flex-1 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white font-medium py-2 rounded-lg transition-colors"
                      >
                        @if (submitting()) {
                          <i class="fas fa-spinner fa-spin me-2"></i>Submitting...
                        } @else {
                          <i class="fas fa-check me-2"></i>Submit Answer
                        }
                      </button>
                      <button
                        type="button"
                        (click)="cancelAnswer()"
                        class="px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium rounded-lg transition-colors"
                      >
                        Cancel
                      </button>
                    </div>
                  </form>
                }
              </div>
            }
          </div>
        }
      </div>
    }
  </main>
